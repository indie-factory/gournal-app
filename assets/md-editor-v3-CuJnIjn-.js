function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{R as Se,C as Il,a as Ll,I as Re,$ as Hl,L as Al,H as ml,x as Ml}from"./@vavt-DtLj4T47.js";import{g as O,i as E,f as s,h as U,j as R,w as S,k as N,l as pe,m as Ne,s as se,p as G,q as te,T as Fl,u as Pl,v as Q,F as xe,x as re,y as Bl}from"./@vue-D1ftCoHK.js";import{_ as Rl,E as ie,H as vl,s as fl,k as Nl,d as Ol,h as Dl,i as jl,a as Rt,m as Vl,u as Wl,r as Ul,b as zl,c as ee,e as Ae,f as ql,p as Gl,C as me,l as Kl,g as Zl,S as Xl,j as Yl}from"./@codemirror-CHsz4VGU.js";import{a as y}from"./@lezer-x_sHd3sj.js";import{m as Jl}from"./medium-zoom-CHfgT04g.js";import{a as Ql}from"./copy-to-clipboard-gvHgSpPc.js";import{M as eo}from"./markdown-it-DI8MEbma.js";import{r as to}from"./markdown-it-image-figures-BD49Kf-b.js";import{T as lo}from"./markdown-it-task-lists-DKHOi6r0.js";import{X as oo}from"./markdown-it-xss-CzKvBubu.js";import{L as no}from"./lru-cache-DBLXwll_.js";const c="md-editor",ao="https://at.alicdn.com/t/c/font_2605852_rfu1p40qggh.js",io="https://at.alicdn.com/t/c/font_2605852_rfu1p40qggh.css",B="https://cdnjs.cloudflare.com/ajax/libs",ro=`${B}/highlight.js/11.8.0/highlight.min.js`,Nt={main:`${B}/prettier/2.8.0/standalone.js`,markdown:`${B}/prettier/2.8.0/parser-markdown.js`},Ot={css:`${B}/cropperjs/1.5.13/cropper.min.css`,js:`${B}/cropperjs/1.5.13/cropper.min.js`},so=`${B}/screenfull.js/5.2.0/screenfull.min.js`,gl=["bold","underline","italic","strikeThrough","-","title","sub","sup","quote","unorderedList","orderedList","task","-","codeRow","code","link","image","table","mermaid","katex","-","revoke","next","save","=","prettier","pageFullscreen","fullscreen","preview","previewOnly","htmlPreview","catalog","github"],hl=["markdownTotal","=","scrollSwitch"],Dt={"zh-CN":{toolbarTips:{bold:"加粗",underline:"下划线",italic:"斜体",strikeThrough:"删除线",title:"标题",sub:"下标",sup:"上标",quote:"引用",unorderedList:"无序列表",orderedList:"有序列表",task:"任务列表",codeRow:"行内代码",code:"块级代码",link:"链接",image:"图片",table:"表格",mermaid:"mermaid图",katex:"katex公式",revoke:"后退",next:"前进",save:"保存",prettier:"美化",pageFullscreen:"浏览器全屏",fullscreen:"屏幕全屏",preview:"预览",previewOnly:"仅预览",htmlPreview:"html代码预览",catalog:"目录",github:"源码地址"},titleItem:{h1:"一级标题",h2:"二级标题",h3:"三级标题",h4:"四级标题",h5:"五级标题",h6:"六级标题"},imgTitleItem:{link:"添加链接",upload:"上传图片",clip2upload:"裁剪上传"},linkModalTips:{linkTitle:"添加链接",imageTitle:"添加图片",descLabel:"链接描述：",descLabelPlaceHolder:"请输入描述...",urlLabel:"链接地址：",urlLabelPlaceHolder:"请输入链接...",buttonOK:"确定"},clipModalTips:{title:"裁剪图片上传",buttonUpload:"上传"},copyCode:{text:"复制代码",successTips:"已复制！",failTips:"复制失败！"},mermaid:{flow:"流程图",sequence:"时序图",gantt:"甘特图",class:"类图",state:"状态图",pie:"饼图",relationship:"关系图",journey:"旅程图"},katex:{inline:"行内公式",block:"块级公式"},footer:{markdownTotal:"字数",scrollAuto:"同步滚动"}},"en-US":{toolbarTips:{bold:"bold",underline:"underline",italic:"italic",strikeThrough:"strikeThrough",title:"title",sub:"subscript",sup:"superscript",quote:"quote",unorderedList:"unordered list",orderedList:"ordered list",task:"task list",codeRow:"inline code",code:"block-level code",link:"link",image:"image",table:"table",mermaid:"mermaid",katex:"formula",revoke:"revoke",next:"undo revoke",save:"save",prettier:"prettier",pageFullscreen:"fullscreen in page",fullscreen:"fullscreen",preview:"preview",previewOnly:"preview only",htmlPreview:"html preview",catalog:"catalog",github:"source code"},titleItem:{h1:"Lv1 Heading",h2:"Lv2 Heading",h3:"Lv3 Heading",h4:"Lv4 Heading",h5:"Lv5 Heading",h6:"Lv6 Heading"},imgTitleItem:{link:"Add Img Link",upload:"Upload Img",clip2upload:"Clip Upload"},linkModalTips:{linkTitle:"Add Link",imageTitle:"Add Image",descLabel:"Desc:",descLabelPlaceHolder:"Enter a description...",urlLabel:"Link:",urlLabelPlaceHolder:"Enter a link...",buttonOK:"OK"},clipModalTips:{title:"Crop Image",buttonUpload:"Upload"},copyCode:{text:"Copy",successTips:"Copied!",failTips:"Copy failed!"},mermaid:{flow:"flow",sequence:"sequence",gantt:"gantt",class:"class",state:"state",pie:"pie",relationship:"relationship",journey:"journey"},katex:{inline:"inline",block:"block"},footer:{markdownTotal:"Character Count",scrollAuto:"Scroll Auto"}}},co=`${B}/mermaid/10.6.1/mermaid.esm.min.mjs`,jt={js:`${B}/KaTeX/0.16.9/katex.min.js`,css:`${B}/KaTeX/0.16.9/katex.min.css`},Vt={a11y:{light:`${B}/highlight.js/11.8.0/styles/a11y-light.min.css`,dark:`${B}/highlight.js/11.8.0/styles/a11y-dark.min.css`},atom:{light:`${B}/highlight.js/11.8.0/styles/atom-one-light.min.css`,dark:`${B}/highlight.js/11.8.0/styles/atom-one-dark.min.css`},github:{light:`${B}/highlight.js/11.8.0/styles/github.min.css`,dark:`${B}/highlight.js/11.8.0/styles/github-dark.min.css`},gradient:{light:`${B}/highlight.js/11.8.0/styles/gradient-light.min.css`,dark:`${B}/highlight.js/11.8.0/styles/gradient-dark.min.css`},kimbie:{light:`${B}/highlight.js/11.8.0/styles/kimbie-light.min.css`,dark:`${B}/highlight.js/11.8.0/styles/kimbie-dark.min.css`},paraiso:{light:`${B}/highlight.js/11.8.0/styles/paraiso-light.min.css`,dark:`${B}/highlight.js/11.8.0/styles/paraiso-dark.min.css`},qtcreator:{light:`${B}/highlight.js/11.8.0/styles/qtcreator-light.min.css`,dark:`${B}/highlight.js/11.8.0/styles/qtcreator-dark.min.css`},stackoverflow:{light:`${B}/highlight.js/11.8.0/styles/stackoverflow-light.min.css`,dark:`${B}/highlight.js/11.8.0/styles/stackoverflow-dark.min.css`}},D={editorExtensions:{},editorConfig:{},codeMirrorExtensions:(e,t)=>t,markdownItConfig:()=>{},markdownItPlugins:e=>e,iconfontType:"svg",mermaidConfig:e=>e},ye=170,X=({instance:e,ctx:t,props:l={}},n="default")=>{const i=(e==null?void 0:e.$slots[n])||(t==null?void 0:t.slots[n]);return(i?i(e):"")||l[n]},uo={overlay:{type:[String,Object],default:""},visible:{type:Boolean,default:!1},onChange:{type:Function,default:()=>{}},relative:{type:String,default:"html"}},ve=O({props:uo,setup(e,t){const l=`${c}-dropdown-hidden`,n=U({overlayClass:[l],overlayStyle:{},triggerHover:!1,overlayHover:!1}),i=R(),a=R(),u=()=>{var o,m;n.triggerHover=!0;const C=i.value,$=a.value;if(!C||!$)return;const g=C.getBoundingClientRect(),b=C.offsetTop,f=C.offsetLeft,h=g.height,p=g.width,w=((o=document.querySelector(e.relative))==null?void 0:o.scrollLeft)||0,T=((m=document.querySelector(e.relative))==null?void 0:m.clientWidth)||0;let _=f-$.offsetWidth/2+p/2-w;_+$.offsetWidth>w+T&&(_=w+T-$.offsetWidth),_<0&&(_=0),n.overlayStyle={...n.overlayStyle,top:b+h+"px",left:_+"px"},e.onChange(!0)},v=()=>{n.overlayHover=!0};S(()=>e.visible,o=>{o?n.overlayClass=n.overlayClass.filter(m=>m!==l):n.overlayClass.push(l)});let d=-1;const r=o=>{i.value===o.target?n.triggerHover=!1:n.overlayHover=!1,clearTimeout(d),d=window.setTimeout(()=>{!n.overlayHover&&!n.triggerHover&&e.onChange(!1)},10)};return N(()=>{i.value.addEventListener("mouseenter",u),i.value.addEventListener("mouseleave",r),a.value.addEventListener("mouseenter",v),a.value.addEventListener("mouseleave",r)}),pe(()=>{i.value.removeEventListener("mouseenter",u),i.value.removeEventListener("mouseleave",r),a.value.removeEventListener("mouseenter",v),a.value.removeEventListener("mouseleave",r)}),()=>{const o=X({ctx:t}),m=X({props:e,ctx:t},"overlay"),C=Ne(o instanceof Array?o[0]:o,{ref:i,key:"cloned-dropdown-trigger"}),$=s("div",{class:[`${c}-dropdown`,n.overlayClass],style:n.overlayStyle,ref:a},[s("div",{class:`${c}-dropdown-overlay`},[m instanceof Array?m[0]:m])]);return[C,$]}}}),mo={title:{type:String,default:""},visible:{type:Boolean},trigger:{type:[String,Object]},onChange:{type:Function},overlay:{type:[String,Object]},insert:{type:Function},language:{type:String},theme:{type:String},default:{type:[String,Object]}},Ce=O({name:"DropdownToolbar",props:mo,emits:["onChange"],setup(e,t){const l=E("editorId");return()=>{const n=X({props:e,ctx:t},"trigger"),i=X({props:e,ctx:t},"overlay"),a=X({props:e,ctx:t});return s(ve,{relative:`#${l}-toolbar-wrapper`,visible:e.visible,onChange:u=>{e.onChange instanceof Function?e.onChange(u):t.emit("onChange",u)},overlay:i},{default:()=>[s("div",{class:`${c}-toolbar-item`,title:e.title||""},[n,a])]})}}});Ce.install=e=>(e.component(Ce.name,Ce),e);var vo=Object.defineProperty,fo=(e,t,l)=>t in e?vo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,go=(e,t,l)=>(fo(e,typeof t!="symbol"?t+"":t,l),l);class ho{constructor(){go(this,"pools",{})}remove(t,l,n){const a=this.pools[t]&&this.pools[t][l];a&&(this.pools[t][l]=a.filter(u=>u!==n))}clear(t){this.pools[t]={}}on(t,l){return this.pools[t]||(this.pools[t]={}),this.pools[t][l.name]||(this.pools[t][l.name]=[]),this.pools[t][l.name].push(l.callback),this.pools[t][l.name].includes(l.callback)}emit(t,l,...n){this.pools[t]||(this.pools[t]={});const a=this.pools[t][l];a&&a.forEach(u=>{try{u(...n)}catch(v){console.error(`${l} monitor event exception！`,v)}})}}const k=new ho,Ee="onSave",je="changeCatalogVisible",bl="changeFullscreen",Wt="pageFullscreenChanged",Ut="fullscreenChanged",zt="previewChanged",qt="previewOnlyChanged",Gt="htmlPreviewChanged",Kt="catalogVisibleChanged",$e="buildFinished",ce="errorCatcher",M="replace",Ie="uploadImage",Oe="openModals",pl="ctrlZ",yl="ctrlShiftZ",De="catalogChanged",kl="pushCatalog",Ve="rerender",Cl="eventListener",bo=(e,t="image.png")=>{const l=e.split(","),n=l[0].match(/:(.*?);/);if(n){const i=n[1],a=atob(l[1]);let u=a.length;const v=new Uint8Array(u);for(;u--;)v[u]=a.charCodeAt(u);return new File([v],t,{type:i})}return null},po=e=>{if(!e)return e;const t=e.split(`
`),l=['<span rn-wrapper aria-hidden="true">'];return t.forEach(()=>{l.push("<span></span>")}),l.push("</span>"),`<span class="code-block">${e}</span>${l.join("")}`},yo=(e,t)=>{if(!e||!t)return 0;const l=e==null?void 0:e.getBoundingClientRect();if(t===document.documentElement)return l.top-t.clientTop;const n=t==null?void 0:t.getBoundingClientRect();return l.top-n.top},ko=(()=>{let e=0;return t=>t+ ++e})(),Zt=(e,t)=>{const l=n=>{const i=e.parentElement||document.body,a=i.offsetWidth,u=i.offsetHeight,{clientWidth:v}=document.documentElement,{clientHeight:d}=document.documentElement,r=n.offsetX,o=n.offsetY,m=$=>{let g=$.x+document.body.scrollLeft-document.body.clientLeft-r,b=$.y+document.body.scrollTop-document.body.clientTop-o;g=g<1?1:g<v-a-1?g:v-a-1,b=b<1?1:b<d-u-1?b:d-u-1,t?t(g,b):(i.style.left=`${g}px`,i.style.top=`${b}px`)};document.addEventListener("mousemove",m);const C=()=>{document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",C)};document.addEventListener("mouseup",C)};return e.addEventListener("mousedown",l),()=>{e.removeEventListener("mousedown",l)}},Z=(e,t="")=>{const l=document.getElementById(e.id),n=e.onload;e.onload=null;const i=function(a){typeof n=="function"&&n.bind(this)(a),e.removeEventListener("load",i)};l?t!==""&&(l.addEventListener("load",i),Reflect.get(window,t)&&l.dispatchEvent(new Event("load"))):(e.addEventListener("load",i),document.head.appendChild(e))},Co=Se((e,t,l)=>{const n=document.getElementById(e);n&&n.setAttribute(t,l)},10),$o=O({props:{name:{type:String,default:""}},setup(e){return()=>D.iconfontType==="svg"?s("svg",{class:`${c}-icon`,"aria-hidden":"true"},[s("use",{"xlink:href":`#${c}-icon-${e.name}`},null)]):s("i",{class:`${c}-iconfont ${c}-icon-${e.name}`},null)}}),x=O({props:{name:{type:String,default:""}},setup(e){const t=E("customIcon");return()=>{const l=t.value[e.name];return typeof l=="object"?typeof l.component=="object"?Pl(l.component,l.props):s("span",{innerHTML:l.component},null):s($o,{name:e.name},null)}}}),wo={title:{type:String,default:""},visible:{type:Boolean,default:!1},width:{type:String,default:"auto"},height:{type:String,default:"auto"},onClose:{type:Function},showAdjust:{type:Boolean,default:!1},isFullscreen:{type:Boolean,default:!1},onAdjust:{type:Function,default:()=>{}},class:{type:String},style:{type:Object,default:()=>({})}},Xt=(()=>{let e=2e4;return()=>++e})(),fe=O({name:"MdModal",props:wo,emits:["onClose"],setup(e,t){const l=E("theme"),n=R(e.visible),i=R([`${c}-modal`]),a=R(),u=R(),v=R(),d=se();let r=()=>{};const o=U({maskStyle:{zIndex:-1},modalStyle:{zIndex:-1},initPos:{left:"0px",top:"0px"},historyPos:{left:"0px",top:"0px"}}),m=G(()=>e.isFullscreen?{width:"100%",height:"100%"}:{width:e.width,height:e.height});return S(()=>e.isFullscreen,C=>{C?r():te(()=>{r=Zt(u.value,($,g)=>{o.initPos.left=$+"px",o.initPos.top=g+"px"})})}),S(()=>e.visible,C=>{C?(o.maskStyle.zIndex=Xt(),o.modalStyle.zIndex=Xt(),i.value.push("zoom-in"),n.value=C,te(()=>{const $=a.value.offsetWidth/2,g=a.value.offsetHeight/2,b=document.documentElement.clientWidth/2,f=document.documentElement.clientHeight/2;o.initPos.left=b-$+"px",o.initPos.top=f-g+"px",e.isFullscreen||(r=Zt(u.value,(h,p)=>{o.initPos.left=h+"px",o.initPos.top=p+"px"}))}),setTimeout(()=>{i.value=i.value.filter($=>$!=="zoom-in")},140)):(i.value.push("zoom-out"),r(),setTimeout(()=>{i.value=i.value.filter($=>$!=="zoom-out"),n.value=C},130))}),N(()=>{v.value=document.body}),()=>{const C=X({ctx:t}),$=X({props:e,ctx:t},"title");return v.value?s(Fl,{to:v.value},{default:()=>[s("div",{ref:d,class:`${c}-modal-container`,"data-theme":l.value},[s("div",{class:e.class,style:{...e.style,display:n.value?"block":"none"}},[s("div",{class:`${c}-modal-mask`,style:o.maskStyle,onClick:()=>{e.onClose?e.onClose():t.emit("onClose")}},null),s("div",{class:i.value,style:{...o.modalStyle,...o.initPos,...m.value},ref:a},[s("div",{class:`${c}-modal-header`,ref:u},[$||""]),s("div",{class:`${c}-modal-body`},[C]),s("div",{class:`${c}-modal-func`},[e.showAdjust&&s("div",{class:`${c}-modal-adjust`,onClick:g=>{g.stopPropagation(),e.isFullscreen?o.initPos=o.historyPos:(o.historyPos=o.initPos,o.initPos={left:"0",top:"0"}),e.onAdjust(!e.isFullscreen)}},[s(x,{name:e.isFullscreen?"suoxiao":"fangda"},null)]),s("div",{class:`${c}-modal-close`,onClick:g=>{g.stopPropagation(),e.onClose?e.onClose():t.emit("onClose")}},[s(x,{name:"close"},null)])])])])])]}):""}}});fe.install=e=>(e.component(fe.name,fe),e);const To=(e,t)=>{const l=E("editorId"),{noImgZoomIn:n}=e;let i=()=>{};S([t,re(e.setting,"preview")],()=>{!n&&e.setting.preview&&i()},{immediate:!0}),N(()=>{i=Se(()=>{const a=document.querySelectorAll(`#${l}-preview img`);a.length!==0&&Jl(a,{background:"#00000073"})})})},_o=(e,t)=>{if(typeof t[e]=="string")return t[e];const l=`<i class="${c}-iconfont ${c}-icon-${e}"></i>`;switch(D.iconfontType){case"svg":return`<svg class="${c}-icon" aria-hidden="true"><use xlink:href="#${c}-icon-${e}"></use></svg>`;default:return l}},So=(e,t,l)=>{const n=E("editorId"),i=E("usedLanguageText"),a=E("customIcon"),u=()=>{document.querySelectorAll(`#${n}-preview pre`).forEach(r=>{var o,m;let C=-1;(o=r.querySelector(".copy-button"))==null||o.remove();const $=((m=i.value.copyCode)==null?void 0:m.text)||"复制代码",g=document.createElement("span");g.setAttribute("class","copy-button"),g.dataset.tips=$,g.innerHTML=_o("copy",a.value),g.addEventListener("click",()=>{var b,f;clearTimeout(C);const h=r.querySelector("code").innerText,p=Ql(e.formatCopiedText(h)),w=((b=i.value.copyCode)==null?void 0:b.successTips)||"已复制！",T=((f=i.value.copyCode)==null?void 0:f.failTips)||"已复制！";g.dataset.tips=p?w:T,C=window.setTimeout(()=>{g.dataset.tips=$},1500)}),r.appendChild(g)})},v=()=>{te(u)},d=r=>{r&&te(u)};S([t,l],v),S(()=>e.setting.preview,d),S(()=>e.setting.htmlPreview,d),S(()=>i.value,u),N(u)},xo=e=>{var t;const l=(t=D.editorExtensions)==null?void 0:t.highlight,n=l==null?void 0:l.instance,i=E("highlight"),a=se(n);return N(()=>{if(!e.noHighlight&&!a.value){const u=document.createElement("script");u.src=i.value.js,u.onload=()=>{a.value=window.hljs},u.id=`${c}-hljs`,Z(u,"hljs");const v=document.createElement("link");v.rel="stylesheet",v.href=i.value.css,v.id=`${c}-hlCss`,Z(v)}}),S(()=>i.value.css,u=>{Co(`${c}-hlCss`,"href",u)}),a},Eo=e=>{const t=E("theme"),{editorExtensions:l,mermaidConfig:n}=D,i=l==null?void 0:l.mermaid,a=se(i==null?void 0:i.instance),u=se(-1),v=new no({max:1e3,ttl:6e5}),d=()=>{const o=a.value;!e.noMermaid&&o&&(o.initialize(n({startOnLoad:!1,theme:t.value==="dark"?"dark":"default"})),u.value=u.value+1)};return S(()=>t.value,()=>{v.clear(),d()}),N(()=>{if(!e.noMermaid&&!(i!=null&&i.instance)){const o=(i==null?void 0:i.js)||co;if(/\.mjs/.test(o))Rl(()=>import(o),__vite__mapDeps([])).then(m=>{a.value=m.default,d()});else{const m=document.createElement("script");m.id=`${c}-mermaid`,m.src=o,m.onload=()=>{a.value=window.mermaid,d()},Z(m,"mermaid")}}}),{mermaidRef:a,reRenderRef:u,replaceMermaid:()=>{te(()=>{if(!e.noMermaid&&a.value){const o=document.querySelectorAll(`div.${c}-mermaid`),m=document.createElement("div");m.style.width=document.body.offsetWidth+"px",m.style.height=document.body.offsetHeight+"px",m.style.position="fixed",m.style.zIndex="-10000",m.style.top="-10000";let C=o.length;C>0&&document.body.appendChild(m),o.forEach(async $=>{let g=v.get($.innerText);if(!g){const f=Re(),h=a.value.renderAsync||a.value.render;let p="";try{p=await h(f,$.innerText,m)}catch{}g=await e.sanitizeMermaid(typeof p=="string"?p:p.svg),v.set($.innerText,g)}const b=document.createElement("p");b.className=`${c}-mermaid`,b.setAttribute("data-processed",""),b.innerHTML=g,$.dataset.line!==void 0&&(b.dataset.line=$.dataset.line),$.replaceWith(b),--C===0&&m.remove()})}})}}},Io=e=>{var t;const l=(t=D.editorExtensions)==null?void 0:t.katex,n=l==null?void 0:l.instance,i=se(n);return N(()=>{if(!e.noKatex&&!i.value){const a=document.createElement("script");a.src=(l==null?void 0:l.js)||jt.js,a.onload=()=>{i.value=window.katex},a.id=`${c}-katex`;const u=document.createElement("link");u.rel="stylesheet",u.href=(l==null?void 0:l.css)||jt.css,u.id=`${c}-katexCss`,Z(a,"katex"),Z(u)}}),i},Lo=(e,t)=>{const l=e.renderer.rules.fence.bind(e.renderer.rules);e.renderer.rules.fence=(n,i,a,u,v)=>{const d=n[i],r=d.content.trim();if(d.info==="mermaid"){let o;return n[i].map&&n[i].level===0&&(o=n[i].map[0],n[i].attrSet("data-line",String(o))),`<div class="${c}-mermaid" ${o!==void 0?"data-line="+o:""} data-mermaid-theme=${t.themeRef.value}>${r}</div>`}return l(n,i,a,u,v)}},Ho=Lo,Yt=(e,t)=>{let l=!0,n=!0;const i=e.posMax,a=t>0?e.src.charCodeAt(t-1):-1,u=t+1<=i?e.src.charCodeAt(t+1):-1;return(a===32||a===9||u>=48&&u<=57)&&(n=!1),(u===32||u===9)&&(l=!1),{can_open:l,can_close:n}},Ao=(e,t)=>{let l,n,i,a;if(e.src[e.pos]!=="$")return!1;if(i=Yt(e,e.pos),!i.can_open)return t||(e.pending+="$"),e.pos+=1,!0;const u=e.pos+1;for(l=u;(l=e.src.indexOf("$",l))!==-1;){for(a=l-1;e.src[a]==="\\";)a-=1;if((l-a)%2==1)break;l+=1}return l===-1?(t||(e.pending+="$"),e.pos=u,!0):l-u===0?(t||(e.pending+="$$"),e.pos=u+1,!0):(i=Yt(e,l),i.can_close?(t||(n=e.push("math_inline","math",0),n.markup="$",n.content=e.src.slice(u,l)),e.pos=l+1,!0):(t||(e.pending+="$"),e.pos=u,!0))},Mo=(e,t,l,n)=>{let i,a,u,v,d=!1,r=e.bMarks[t]+e.tShift[t],o=e.eMarks[t];if(r+2>o||e.src.slice(r,r+2)!=="$$")return!1;if(r+=2,i=e.src.slice(r,o),n)return!0;for(i.trim().slice(-2)==="$$"&&(i=i.trim().slice(0,-2),d=!0),u=t;!d&&(u++,!(u>=l||(r=e.bMarks[u]+e.tShift[u],o=e.eMarks[u],r<o&&e.tShift[u]<e.blkIndent)));)e.src.slice(r,o).trim().slice(-2)==="$$"&&(v=e.src.slice(0,o).lastIndexOf("$$"),a=e.src.slice(r,v),d=!0);e.line=u+1;const m=e.push("math_block","math",0);return m.block=!0,m.content=(i&&i.trim()?i+`
`:"")+e.getLines(t+1,u,e.tShift[t],!0)+(a&&a.trim()?a:""),m.map=[t,e.line],m.markup="$$",!0},Fo=(e,t)=>{const l=i=>{if(t.katexRef.value){const a=t.katexRef.value.renderToString(i,{throwOnError:!1});return`<span class="${c}-katex-inline" data-processed>${a}</span>`}else return`<span class="${c}-katex-inline">${i}</span>`},n=(i,a)=>{if(t.katexRef.value){const u=t.katexRef.value.renderToString(i,{throwOnError:!1,displayMode:!0});return`<p class="${c}-katex-block" data-line=${a} data-processed>${u}</p>`}else return`<p class="${c}-katex-block" data-line=${a}>${i}</p>`};e.inline.ruler.after("escape","math_inline",Ao),e.block.ruler.after("blockquote","math_block",Mo,{alt:["paragraph","reference","blockquote","list"]}),e.renderer.rules.math_inline=(i,a)=>l(i[a].content),e.renderer.rules.math_block=(i,a)=>n(i[a].content,i[a].map[0])+`
`},Po=Fo,Bo=(e,t)=>{t=t||{};const l=3,n=t.marker||"!",i=n.charCodeAt(0),a=n.length;let u="",v="";const d=(o,m,C,$,g)=>{const b=o[m];return b.type==="admonition_open"?(o[m].attrPush(["class",`${c}-admonition ${c}-admonition-${b.info}`]),o[m].attrSet("data-line",String(o[m].map[0]))):b.type==="admonition_title_open"&&o[m].attrPush(["class",`${c}-admonition-title`]),g.renderToken(o,m,C)},r=o=>{const m=o.trim().split(" ",2);v="",u=m[0],m.length>1&&(v=o.substring(u.length+2)),(v===""||!v)&&(v=u)};e.block.ruler.before("code","admonition",(o,m,C,$)=>{let g,b,f,h=!1,p=o.bMarks[m]+o.tShift[m],w=o.eMarks[m];if(i!==o.src.charCodeAt(p))return!1;for(g=p+1;g<=w&&n[(g-p)%a]===o.src[g];g++);const T=Math.floor((g-p)/a);if(T!==l)return!1;g-=(g-p)%a;const _=o.src.slice(p,g),A=o.src.slice(g,w);if(r(A),$)return!0;for(b=m;b++,!(b>=C||(p=o.bMarks[b]+o.tShift[b],w=o.eMarks[b],p<w&&o.sCount[b]<o.blkIndent));)if(i===o.src.charCodeAt(p)&&!(o.sCount[b]-o.blkIndent>=4)){for(g=p+1;g<=w&&n[(g-p)%a]===o.src[g];g++);if(!(Math.floor((g-p)/a)<T)&&(g-=(g-p)%a,g=o.skipSpaces(g),!(g<w))){h=!0;break}}const H=o.parentType,I=o.lineMax;return o.parentType="root",o.lineMax=b,f=o.push("admonition_open","div",1),f.markup=_,f.block=!0,f.info=u,f.map=[m,b],f=o.push("admonition_title_open","p",1),f.markup=_+" "+u,f.map=[m,b],f=o.push("inline","",0),f.content=v,f.map=[m,o.line-1],f.children=[],f=o.push("admonition_title_close","p",-1),f.markup=_+" "+u,o.md.block.tokenize(o,m+1,b),f=o.push("admonition_close","div",-1),f.markup=o.src.slice(p,g),f.block=!0,o.parentType=H,o.lineMax=I,o.line=b+(h?1:0),!0},{alt:["paragraph","reference","blockquote","list"]}),e.renderer.rules.admonition_open=d,e.renderer.rules.admonition_title_open=d,e.renderer.rules.admonition_title_close=d,e.renderer.rules.admonition_close=d},Ro=Bo,No=(e,t)=>{e.renderer.rules.heading_open=(l,n)=>{var i;const a=l[n],u=((i=l[n+1].children)==null?void 0:i.reduce((d,r)=>d+(r.content||""),""))||"",v=a.markup.length;return t.headsRef.value.push({text:u,level:v}),a.map&&a.level===0&&(a.attrSet("data-line",String(a.map[0])),a.attrSet("id",t.mdHeadingId(u,v,t.headsRef.value.length))),e.renderer.renderToken(l,n,t)},e.renderer.rules.heading_close=(l,n,i,a,u)=>u.renderToken(l,n,i)},Oo=No,Do=(e,t)=>{const l=e.renderer.rules.fence,n=e.utils.unescapeAll,i=/\[(\w*)(?::([\w ]*))?\]/;function a(r){return r.info?n(r.info).trim():""}function u(r){const o=a(r),[m=null,C=""]=(i.exec(o)||[]).slice(1);return[m,C]}function v(r){const o=a(r);return o?o.split(/(\s+)/g)[0]:""}const d=(r,o,m,C,$)=>{if(r[o].hidden)return"";const[g,b]=u(r[o]);if(g===null)return l(r,o,m,C,$);let f,h,p,w,T="",_="";for(let A=o;A<r.length&&(f=r[A],[h,p]=u(f),h===g);A++)f.info=f.info.replace(i,""),f.hidden=!0,w=A-o>0?"":" checked",T+=`<li><input type="radio" name="label-group-${t.editorId}-${o}"${w}><label for="group-${t.editorId}-${o}-tab-${A-o}" onclick="this.previousElementSibling.click()">${p||v(f)}</label></li>
`,_+=`<input type="radio" id="group-${t.editorId}-${o}-tab-${A-o}" name="group-${t.editorId}-${o}"${w}>
`+l(r,A,m,C,$);return`<div class="code-tabs">
<ul>
`+T+`</ul>
`+_+"</div>"};e.renderer.rules.fence=d},jo=Do,Vo=e=>{["paragraph_open","table_open","ordered_list_open","bullet_list_open","blockquote_open","hr","html_block","fence"].forEach(t=>{const l=e.renderer.rules[t];l?e.renderer.rules[t]=(n,i,a,u,v)=>{let d;const r=l(n,i,a,u,v);return n[i].map&&n[i].level===0&&!/^<!--/.test(r)?(d=n[i].map[0],r.replace(/^(<[^>]*)/,`$1 data-line="${d}"`)):r}:e.renderer.rules[t]=(n,i,a,u,v)=>{let d;return n[i].map&&n[i].level===0&&(d=n[i].map[0],n[i].attrSet("data-line",String(d))),v.renderToken(n,i,a)}})},Wo=(e,t)=>{const{editorConfig:l,markdownItConfig:n,markdownItPlugins:i}=D,a=E("editorId"),u=E("showCodeRowNumber"),v=E("theme"),d=R([]),r=xo(e),o=Io(e),{reRenderRef:m,replaceMermaid:C}=Eo(e),$=eo({html:!0,breaks:!0});n($,{editorId:a});const g=[{type:"katex",plugin:Po,options:{katexRef:o}},{type:"image",plugin:to,options:{figcaption:!0,classes:"md-zoom"}},{type:"admonition",plugin:Ro,options:{}},{type:"taskList",plugin:lo,options:{}},{type:"heading",plugin:Oo,options:{mdHeadingId:e.mdHeadingId,headsRef:d}},{type:"codeTabs",plugin:jo,options:{editorId:a}},{type:"xss",plugin:oo,options:{xss(_){return{whiteList:Object.assign({},_.getDefaultWhiteList(),{input:["class","disabled","type","checked"],iframe:["class","width","height","src","title","border","frameborder","framespacing","allow","allowfullscreen"]})}}}}];e.noMermaid||g.push({type:"mermaid",plugin:Ho,options:{themeRef:v}}),i(g,{editorId:a}).forEach(_=>{$.use(_.plugin,_.options)});const b=$.options.highlight;$.set({highlight:(_,A,H)=>{if(b){const P=b(_,A,H);if(P)return P}let I;!e.noHighlight&&r.value?r.value.getLanguage(A)?I=r.value.highlight(_,{language:A,ignoreIllegals:!0}).value:I=r.value.highlightAuto(_).value:I=$.utils.escapeHtml(_);const F=u?po(I.replace(/^\n+|\n+$/g,"")):`<span class="code-block">${I.replace(/^\n+|\n+$/g,"")}</span>`;return`<pre><code class="language-${A}" language=${A}>${F}</code></pre>`}}),Vo($);const f=R(`_article-key_${Re()}`),h=R(e.sanitize($.render(e.modelValue))),p=()=>{k.emit(a,$e,h.value),e.onHtmlChanged(h.value),e.onGetCatalog(d.value),k.emit(a,De,d.value),C()};N(p);const w=()=>{d.value=[],h.value=e.sanitize($.render(e.modelValue)),p()},T=G(()=>(e.noKatex||o.value)&&(e.noHighlight||r.value));return S([re(e,"modelValue"),T,m],Se(w,(l==null?void 0:l.renderDelay)!==void 0?l==null?void 0:l.renderDelay:t?0:500)),N(()=>{k.on(a,{name:kl,callback(){k.emit(a,De,d.value)}}),k.on(a,{name:Ve,callback:()=>{w(),f.value=`_article-key_${Re()}`}})}),{html:h,key:f}},Uo=Wo,$l={modelValue:{type:String,default:""},setting:{type:Object,default:()=>({preview:!0})},onHtmlChanged:{type:Function,default:()=>{}},onGetCatalog:{type:Function,default:()=>{}},mdHeadingId:{type:Function,default:()=>""},noMermaid:{type:Boolean,default:!1},sanitize:{type:Function,default:e=>e},noKatex:{type:Boolean,default:!1},formatCopiedText:{type:Function,default:e=>e},noHighlight:{type:Boolean,default:!1},previewOnly:{type:Boolean,default:!1},noImgZoomIn:{type:Boolean},sanitizeMermaid:{type:Function}},zo={...$l,updateModelValue:{type:Function,default:()=>{}},onChange:{type:Function,default:()=>{}},placeholder:{type:String,default:""},scrollAuto:{type:Boolean},autofocus:{type:Boolean},disabled:{type:Boolean},readonly:{type:Boolean},maxlength:{type:Number},autoDetectCode:{type:Boolean},onBlur:{type:Function,default:()=>{}},onFocus:{type:Function,default:()=>{}},noPrettier:{type:Boolean},completions:{type:Array},catalogVisible:{type:Boolean},theme:{type:String,default:"light"},onInput:{type:Function},onDrop:{type:Function,default:()=>{}},inputBoxWitdh:{type:String},onInputBoxWitdhChange:{type:Function},transformImgUrl:{type:Function,default:e=>e}},wl=O({name:"ContentPreview",props:$l,setup(e){const t=E("editorId"),l=E("previewTheme"),n=E("showCodeRowNumber"),{html:i,key:a}=Uo(e,e.previewOnly);return So(e,i,a),To(e,i),()=>s(xe,null,[e.setting.preview&&s("div",{id:`${t}-preview-wrapper`,class:`${c}-preview-wrapper`,key:"content-preview-wrapper"},[s("div",{key:a.value,id:`${t}-preview`,class:[`${c}-preview`,`${l==null?void 0:l.value}-theme`,n&&`${c}-scrn`],innerHTML:i.value},null)]),!e.previewOnly&&e.setting.htmlPreview&&s("div",{id:`${t}-html-wrapper`,class:`${c}-preview-wrapper`,key:"html-preview-wrapper"},[s("div",{class:`${c}-html`},[i.value])])])}}),qo=(e,t)=>{const{editorId:l}=e,n=U({buildFinished:!1,html:""});S(()=>e.modelValue,()=>{n.buildFinished=!1}),N(()=>{k.on(l,{name:$e,callback(i){n.buildFinished=!0,n.html=i}}),k.on(l,{name:Ee,callback(){const i=new Promise(a=>{if(n.buildFinished)a(n.html);else{const u=v=>{a(v),k.remove(l,$e,u)};k.on(l,{name:$e,callback:u})}});e.onSave?e.onSave(e.modelValue,i):t.emit("onSave",e.modelValue,i)}})})},Tl=e=>{var t,l;const{editorId:n}=e,i=(l=(t=D)==null?void 0:t.editorExtensions)==null?void 0:l.highlight;Q("editorId",n),Q("theme",G(()=>e.theme)),Q("language",G(()=>e.language)),Q("highlight",G(()=>{const u={...Vt,...i==null?void 0:i.css},v=e.codeStyleReverse&&e.codeStyleReverseList.includes(e.previewTheme)?"dark":e.theme;return{js:(i==null?void 0:i.js)||ro,css:u[e.codeTheme]?u[e.codeTheme][v]:Vt.atom[v]}})),Q("showCodeRowNumber",e.showCodeRowNumber);const a=G(()=>{var u,v;const d={...Dt,...(v=(u=D)==null?void 0:u.editorConfig)==null?void 0:v.languageUserDefined};return Il(Ll(Dt["en-US"]),d[e.language]||{})});Q("usedLanguageText",a),Q("previewTheme",G(()=>e.previewTheme)),Q("customIcon",G(()=>e.customIcon))},Go=e=>{Tl(e),Q("tabWidth",e.tabWidth)},_l=e=>{N(()=>{var t,l;if(!e.noIconfont)if(D.iconfontType==="svg"){const n=document.createElement("script");n.src=((t=D.editorExtensions)==null?void 0:t.iconfont)||ao,n.id=`${c}-icon`,Z(n)}else{const n=document.createElement("link");n.rel="stylesheet",n.href=((l=D.editorExtensions)==null?void 0:l.iconfontClass)||io,n.id=`${c}-icon-class`,Z(n)}})},Ko=e=>{var t,l,n,i,a,u;const{noPrettier:v,noUploadImg:d}=e,{editorExtensions:r}=D,o=v||!!((l=(t=D.editorExtensions)==null?void 0:t.prettier)!=null&&l.prettierInstance),m=v||!!((i=(n=D.editorExtensions)==null?void 0:n.prettier)!=null&&i.parserMarkdownInstance),C=d||!!((u=(a=D.editorExtensions)==null?void 0:a.cropper)!=null&&u.instance);N(()=>{var $,g,b,f;const h=document.createElement("script"),p=document.createElement("script");h.src=(($=r==null?void 0:r.prettier)==null?void 0:$.standaloneJs)||Nt.main,h.id=`${c}-prettier`,p.src=((g=r==null?void 0:r.prettier)==null?void 0:g.parserMarkdownJs)||Nt.markdown,p.id=`${c}-prettierMD`;const w=document.createElement("link");w.rel="stylesheet",w.href=((b=r==null?void 0:r.cropper)==null?void 0:b.css)||Ot.css,w.id=`${c}-cropperCss`;const T=document.createElement("script");T.src=((f=r==null?void 0:r.cropper)==null?void 0:f.js)||Ot.js,T.id=`${c}-cropper`,C||(Z(w),Z(T)),o||Z(h),m||Z(p)}),_l(e)},Zo=(e,t)=>{const{editorId:l}=e;N(()=>{k.on(l,{name:ce,callback:n=>{e.onError instanceof Function?e.onError(n):t.emit("onError",n)}})})},Xo=(e,t)=>{const{editorId:l}=e,n=U({pageFullscreen:e.pageFullscreen,fullscreen:!1,preview:e.preview,htmlPreview:e.preview?!1:e.htmlPreview,previewOnly:!1}),i=(v,d)=>{n[v]=d===void 0?!n[v]:d,v==="preview"?(n.htmlPreview=!1,n.previewOnly=!1):v==="htmlPreview"?(n.preview=!1,n.previewOnly=!1):v==="previewOnly"&&!n.preview&&!n.htmlPreview&&(n.preview=!0)};let a="";const u=()=>{n.pageFullscreen||n.fullscreen?document.body.style.overflow="hidden":document.body.style.overflow=a};return S(()=>[n.pageFullscreen,n.fullscreen],u),N(()=>{k.on(l,{name:Ie,callback(v,d){const r=o=>{k.emit(l,M,"image",{desc:"",urls:o}),d&&d()};e.onUploadImg?e.onUploadImg(v,r):t.emit("onUploadImg",v,r)}}),a=document.body.style.overflow,u()}),[n,i]},Yo=e=>{const{editorId:t}=e,l=R(!1);return N(()=>{k.on(t,{name:je,callback:i=>{i===void 0?l.value=!l.value:l.value=i}})}),G(()=>!e.toolbarsExclude.includes("catalog")&&e.toolbars.includes("catalog")&&l.value)},Jo=(e,t,l,n,i,a)=>{const{editorId:u}=e;S(()=>n.pageFullscreen,d=>{k.emit(u,Wt,d)}),S(()=>n.fullscreen,d=>{k.emit(u,Ut,d)}),S(()=>n.preview,d=>{k.emit(u,zt,d)}),S(()=>n.previewOnly,d=>{k.emit(u,qt,d)}),S(()=>n.htmlPreview,d=>{k.emit(u,Gt,d)}),S(l,d=>{k.emit(u,Kt,d)});const v={on(d,r){switch(d){case"pageFullscreen":{k.on(u,{name:Wt,callback(o){r(o)}});break}case"fullscreen":{k.on(u,{name:Ut,callback(o){r(o)}});break}case"preview":{k.on(u,{name:zt,callback(o){r(o)}});break}case"previewOnly":{k.on(u,{name:qt,callback(o){r(o)}});break}case"htmlPreview":{k.on(u,{name:Gt,callback(o){r(o)}});break}case"catalog":{k.on(u,{name:Kt,callback(o){r(o)}});break}}},togglePageFullscreen(d){i("pageFullscreen",d)},toggleFullscreen(d){k.emit(u,bl,d)},togglePreview(d){i("preview",d)},togglePreviewOnly(d){i("previewOnly",d)},toggleHtmlPreview(d){i("htmlPreview",d)},toggleCatalog(d){k.emit(u,je,d)},triggerSave(){k.emit(u,Ee)},insert(d){k.emit(u,M,"universal",{generate:d})},focus(d){var r;(r=a.value)==null||r.focus(d)},rerender(){k.emit(u,Ve)},getSelectedText(){var d;return(d=a.value)==null?void 0:d.getSelectedText()},resetHistory(){var d;(d=a.value)==null||d.resetHistory()},domEventHandlers(d){k.emit(u,Cl,d)},execCommand(d){k.emit(u,M,d)}};t.expose(v)},Qo=e=>e,Sl={modelValue:{type:String,default:""},theme:{type:String,default:"light"},class:{type:String,default:""},language:{type:String,default:"zh-CN"},onHtmlChanged:{type:Function},onGetCatalog:{type:Function},editorId:{type:String,default:()=>ko("md-editor-v3_")},showCodeRowNumber:{type:Boolean,default:!1},previewTheme:{type:String,default:"default"},style:{type:Object,default:()=>({})},mdHeadingId:{type:Function,default:Qo},sanitize:{type:Function,default:e=>e},noMermaid:{type:Boolean,default:!1},noKatex:{type:Boolean,default:!1},codeTheme:{type:String,default:"atom"},noIconfont:{type:Boolean},formatCopiedText:{type:Function,default:e=>e},codeStyleReverse:{type:Boolean,default:!0},codeStyleReverseList:{type:Array,default:["default","mk-cute"]},noHighlight:{type:Boolean,default:!1},noImgZoomIn:{type:Boolean,default:!1},customIcon:{type:Object,default:{}},sanitizeMermaid:{type:Function,default:e=>Promise.resolve(e)}},en={...Sl,onChange:{type:Function},onSave:{type:Function},onUploadImg:{type:Function},pageFullscreen:{type:Boolean,default:!1},preview:{type:Boolean,default:!0},htmlPreview:{type:Boolean,default:!1},toolbars:{type:Array,default:gl},toolbarsExclude:{type:Array,default:[]},noPrettier:{type:Boolean,default:!1},tabWidth:{type:Number,default:2},tableShape:{type:Array,default:()=>[6,4]},placeholder:{type:String,default:""},defToolbars:{type:[String,Object]},onError:{type:Function},footers:{type:Array,default:hl},scrollAuto:{type:Boolean,default:!0},defFooters:{type:[String,Object]},noUploadImg:{type:Boolean},autoFocus:{type:Boolean},disabled:{type:Boolean},readOnly:{type:Boolean},maxLength:{type:Number},autoDetectCode:{type:Boolean},onBlur:{type:Function},onFocus:{type:Function},completions:{type:Array},showToolbarName:{type:Boolean,default:!1},onInput:{type:Function},onDrop:{type:Function},inputBoxWitdh:{type:String,default:"50%"},onInputBoxWitdhChange:{type:Function},transformImgUrl:{type:Function,default:e=>e}},xl=["onHtmlChanged","onGetCatalog"],tn=[...xl,"onChange","onSave","onUploadImg","onError","update:modelValue","onBlur","onFocus","onInput","onDrop","onInputBoxWitdhChange"],ln=(e,t)=>{const{editorId:l}=e,n={rerender(){k.emit(l,Ve)}};t.expose(n)},we=O({name:"MdPreview",props:Sl,emits:xl,setup(e,t){const{editorId:l,noKatex:n,noMermaid:i,noHighlight:a}=e;return Tl(e),_l(e),ln(e,t),pe(()=>{k.clear(l)}),()=>s("div",{id:l,class:[c,e.class,e.theme==="dark"&&`${c}-dark`,`${c}-previewOnly`],style:e.style},[s(wl,{modelValue:e.modelValue,onHtmlChanged:u=>{e.onHtmlChanged?e.onHtmlChanged(u):t.emit("onHtmlChanged",u)},onGetCatalog:u=>{e.onGetCatalog?e.onGetCatalog(u):t.emit("onGetCatalog",u)},mdHeadingId:e.mdHeadingId,noMermaid:i,sanitize:e.sanitize,noKatex:n,formatCopiedText:e.formatCopiedText,noHighlight:a,noImgZoomIn:e.noImgZoomIn,previewOnly:!0,sanitizeMermaid:e.sanitizeMermaid},null)])}});we.install=e=>(e.component(we.name,we),e);const on={tocItem:{type:Object,default:()=>({})},mdHeadingId:{type:Function,default:()=>{}},scrollElement:{type:[String,Object],default:""},onClick:{type:Function,default:()=>{}},scrollElementOffsetTop:{type:Number,default:0}},El=O({props:on,setup(e){return()=>{const{tocItem:t,mdHeadingId:l,scrollElement:n,onClick:i,scrollElementOffsetTop:a}=e;return s("div",{class:[`${c}-catalog-link`,t.active&&`${c}-catalog-active`],onClick:u=>{i(u,t),u.stopPropagation();const v=l(t.text,t.level,t.index),d=document.getElementById(v),r=n instanceof Element?n:document.querySelector(n);if(d&&r){let o=d.offsetParent,m=d.offsetTop;if(r.contains(o))for(;o&&r!=o;)m+=o==null?void 0:o.offsetTop,o=o==null?void 0:o.offsetParent;r==null||r.scrollTo({top:m-a,behavior:"smooth"})}}},[s("span",{title:t.text},[t.text]),s("div",{class:`${c}-catalog-wrapper`},[t.children&&t.children.map(u=>s(El,{mdHeadingId:l,key:`${t.text}-link-${u.level}-${u.text}`,tocItem:u,scrollElement:n,onClick:i,scrollElementOffsetTop:a},null))])])}}}),nn=El,an={editorId:{type:String},class:{type:String,default:""},mdHeadingId:{type:Function,default:e=>e},scrollElement:{type:[String,Object]},theme:{type:String,default:"light"},offsetTop:{type:Number,default:20},scrollElementOffsetTop:{type:Number,default:0},onClick:{type:Function},onActive:{type:Function}},be=O({name:"MdCatalog",props:an,emits:["onClick","onActive"],setup(e,t){const l=e.editorId,n=U({list:[],show:!1,scrollElement:e.scrollElement||`#${l}-preview-wrapper`}),i=se(),a=G(()=>{const r=[];return n.list.forEach((o,m)=>{const{text:C,level:$}=o,g={level:$,text:C,index:m+1,active:i.value===o};if(r.length===0)r.push(g);else{let b=r[r.length-1];if(g.level>b.level)for(let f=b.level+1;f<=6;f++){const{children:h}=b;if(!h){b.children=[g];break}if(b=h[h.length-1],g.level<=b.level){h.push(g);break}}else r.push(g)}}),r}),u=()=>n.scrollElement instanceof HTMLElement?n.scrollElement:document.querySelector(n.scrollElement),v=r=>{if(r.length===0)return n.list=[],!1;const{activeHead:o}=r.reduce((m,C,$)=>{const g=document.getElementById(e.mdHeadingId(C.text,C.level,$+1));if(g instanceof HTMLElement){const b=u(),f=yo(g,b);if(f<e.offsetTop&&f>m.minTop)return{activeHead:C,minTop:f}}return m},{activeHead:r[0],minTop:Number.MIN_SAFE_INTEGER});i.value=o,n.list=r},d=()=>{v(n.list)};return S(()=>i.value,r=>{const o=r?{...r}:void 0;e.onActive?e.onActive(o):t.emit("onActive",o)}),N(()=>{const r=u(),o=r===document.documentElement?window:r;o==null||o.addEventListener("scroll",d),k.on(l,{name:De,callback:m=>{o==null||o.removeEventListener("scroll",d),v(m),o==null||o.addEventListener("scroll",d)}}),k.emit(l,kl)}),pe(()=>{var r;const o=u();(r=o===document.documentElement?window:o)==null||r.removeEventListener("scroll",d)}),()=>s("div",{class:`${c}-catalog${e.theme==="dark"?"-dark":""} ${e.class}`},[a.value.map(r=>s(nn,{mdHeadingId:e.mdHeadingId,tocItem:r,key:`link-${r.level}-${r.text}`,scrollElement:n.scrollElement,onClick:(o,m)=>{e.onClick?e.onClick(o,m):t.emit("onClick",o,m)},scrollElementOffsetTop:e.scrollElementOffsetTop},null))])}});be.install=e=>(e.component(be.name,be),e);const rn={title:{type:String,default:""},trigger:{type:[String,Object]},onClick:{type:Function},insert:{type:Function},language:{type:String},theme:{type:String}},Te=O({name:"NormalToolbar",props:rn,emits:["onClick"],setup(e,t){return()=>{const l=X({props:e,ctx:t},"trigger");return s("div",{class:`${c}-toolbar-item`,title:e.title,onClick:n=>{e.onClick instanceof Function?e.onClick(n):t.emit("onClick",n)}},[l])}}});Te.install=e=>(e.component(Te.name,Te),e);function sn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Bl(e)}const cn={title:{type:String,default:""},modalTitle:{type:String,default:""},visible:{type:Boolean},width:{type:String,default:"auto"},height:{type:String,default:"auto"},trigger:{type:[String,Object]},onClick:{type:Function},onClose:{type:Function},showAdjust:{type:Boolean,default:!1},isFullscreen:{type:Boolean,default:!1},onAdjust:{type:Function},insert:{type:Function},language:{type:String},theme:{type:String}},_e=O({name:"ModalToolbar",props:cn,emits:["onClick","onClose","onAdjust"],setup(e,t){return()=>{const l=X({props:e,ctx:t},"trigger"),n=X({props:e,ctx:t},"default");return s(xe,null,[s("div",{class:`${c}-toolbar-item`,title:e.title,onClick:()=>{e.onClick instanceof Function?e.onClick():t.emit("onClick")}},[l]),s(fe,{width:e.width,height:e.height,title:e.modalTitle,visible:e.visible,onClose:()=>{e.onClose instanceof Function?e.onClose():t.emit("onClose")},showAdjust:e.showAdjust,isFullscreen:e.isFullscreen,onAdjust:i=>{e.onAdjust instanceof Function?e.onAdjust(i):t.emit("onAdjust",i)}},sn(n)?n:{default:()=>[n]})])}}});_e.install=e=>(e.component(_e.name,_e),e);var un=Object.defineProperty,dn=(e,t,l)=>t in e?un(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,ae=(e,t,l)=>(dn(e,typeof t!="symbol"?t+"":t,l),l);const mn=O({setup(){return()=>s("div",{class:`${c}-divider`},null)}}),vn={noPrettier:{type:Boolean},toolbars:{type:Array,default:()=>[]},toolbarsExclude:{type:Array,default:()=>[]},setting:{type:Object,default:()=>({})},screenfull:{type:Object,default:null},screenfullJs:{type:String,default:""},updateSetting:{type:Function,default:()=>{}},tableShape:{type:Array,default:()=>[6,4]},defToolbars:{type:Object},noUploadImg:{type:Boolean},showToolbarName:{type:Boolean}},fn=e=>{var t,l,n,i;const a=E("editorId");let u=(l=(t=D.editorExtensions)==null?void 0:t.screenfull)==null?void 0:l.instance;const v=(i=(n=D.editorExtensions)==null?void 0:n.screenfull)==null?void 0:i.js,d=R(!1),r=C=>{if(!u){k.emit(a,ce,{name:"fullscreen",message:"fullscreen is undefined"});return}u.isEnabled?(d.value=!0,(C===void 0?!u.isFullscreen:C)?u.request():u.exit()):console.error("browser does not support screenfull!")},o=()=>{u&&u.isEnabled&&u.on("change",()=>{(d.value||e.setting.fullscreen)&&(d.value=!1,e.updateSetting("fullscreen"))})},m=()=>{u=window.screenfull,o()};return N(()=>{if(o(),!u){const C=document.createElement("script");C.src=v||so,C.onload=m,C.id=`${c}-screenfull`,Z(C,"screenfull")}}),N(()=>{k.on(a,{name:bl,callback:r})}),{fullscreenHandler:r}},gn={tableShape:{type:Array,default:()=>[6,4]},onSelected:{type:Function,default:()=>{}}},hn=O({name:"TableShape",props:gn,setup(e){const t=U({x:-1,y:-1});return()=>s("div",{class:`${c}-table-shape`,onMouseleave:()=>{t.x=-1,t.y=-1}},[new Array(e.tableShape[1]).fill("").map((l,n)=>s("div",{class:`${c}-table-shape-row`,key:`table-shape-row-${n}`},[new Array(e.tableShape[0]).fill("").map((i,a)=>s("div",{class:`${c}-table-shape-col`,key:`table-shape-col-${a}`,onMouseenter:()=>{t.x=n,t.y=a},onClick:()=>{e.onSelected(t)}},[s("div",{class:[`${c}-table-shape-col-default`,n<=t.x&&a<=t.y&&`${c}-table-shape-col-include`]},null)]))]))])}}),bn=hn,pn={type:{type:String,default:"link"},visible:{type:Boolean,default:!1},onCancel:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}}},yn=O({props:pn,setup(e){const t=E("usedLanguageText"),l=E("editorId"),n=G(()=>{var a,u;switch(e.type){case"link":return(a=t.value.linkModalTips)==null?void 0:a.linkTitle;case"image":return(u=t.value.linkModalTips)==null?void 0:u.imageTitle;default:return""}}),i=U({desc:"",url:""});return S(()=>e.visible,a=>{a||setTimeout(()=>{i.desc="",i.url=""},200)}),()=>s(fe,{title:n.value,visible:e.visible,onClose:e.onCancel},{default:()=>{var a,u,v,d,r;return[s("div",{class:`${c}-form-item`},[s("label",{class:`${c}-label`,for:`link-desc-${l}`},[(a=t.value.linkModalTips)==null?void 0:a.descLabel]),s("input",{placeholder:(u=t.value.linkModalTips)==null?void 0:u.descLabelPlaceHolder,class:`${c}-input`,id:`link-desc-${l}`,type:"text",value:i.desc,onChange:o=>{i.desc=o.target.value},autocomplete:"off"},null)]),s("div",{class:`${c}-form-item`},[s("label",{class:`${c}-label`,for:`link-url-${l}`},[(v=t.value.linkModalTips)==null?void 0:v.urlLabel]),s("input",{placeholder:(d=t.value.linkModalTips)==null?void 0:d.urlLabelPlaceHolder,class:`${c}-input`,id:`link-url-${l}`,type:"text",value:i.url,onChange:o=>{i.url=o.target.value},autocomplete:"off"},null)]),s("div",{class:`${c}-form-item`},[s("button",{class:[`${c}-btn`,`${c}-btn-row`],type:"button",onClick:()=>{e.onOk(i),i.desc="",i.url=""}},[(r=t.value.linkModalTips)==null?void 0:r.buttonOK])])]}})}}),kn={visible:{type:Boolean,default:!1},onCancel:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}}},Cn=O({props:kn,setup(e){var t,l,n;const i=E("usedLanguageText"),a=E("editorId");let u=(n=(l=(t=D)==null?void 0:t.editorExtensions)==null?void 0:l.cropper)==null?void 0:n.instance;const v=R(),d=R(),r=R(),o=U({cropperInited:!1,imgSelected:!1,imgSrc:"",isFullscreen:!1});let m=null;S(()=>e.visible,()=>{e.visible&&!o.cropperInited&&(u=u||window.Cropper,v.value.onchange=()=>{if(!u){k.emit(a,ce,{name:"Cropper",message:"Cropper is undefined"});return}const $=v.value.files||[];if(o.imgSelected=!0,($==null?void 0:$.length)>0){const g=new FileReader;g.onload=b=>{o.imgSrc=b.target.result,te(()=>{m=new u(d.value,{viewMode:2,preview:`.${c}-clip-preview-target`})})},g.readAsDataURL($[0])}})}),S(()=>[o.imgSelected],()=>{r.value.style=""}),S(()=>o.isFullscreen,()=>{te(()=>{m==null||m.destroy(),r.value.style="",d.value&&(m=new u(d.value,{viewMode:2,preview:`.${c}-clip-preview-target`}))})});const C=()=>{m.clear(),m.destroy(),m=null,v.value.value="",o.imgSelected=!1};return()=>{var $;return s(fe,{class:`${c}-modal-clip`,title:($=i.value.clipModalTips)==null?void 0:$.title,visible:e.visible,onClose:e.onCancel,showAdjust:!0,isFullscreen:o.isFullscreen,onAdjust:g=>{o.isFullscreen=g},width:"668px",height:"421px"},{default:()=>{var g,b;return[s("div",{class:`${c}-form-item ${c}-clip`},[s("div",{class:`${c}-clip-main`},[o.imgSelected?s("div",{class:`${c}-clip-cropper`},[s("img",{src:o.imgSrc,ref:d,style:{display:"none"},alt:""},null),s("div",{class:`${c}-clip-delete`,onClick:C},[s(x,{name:"delete"},null)])]):s("div",{class:`${c}-clip-upload`,onClick:()=>{v.value.click()}},[s(x,{name:"upload"},null)])]),s("div",{class:`${c}-clip-preview`},[s("div",{class:`${c}-clip-preview-target`,ref:r},null)])]),s("div",{class:`${c}-form-item`},[s("button",{class:`${c}-btn`,type:"button",onClick:()=>{if(m){const f=m.getCroppedCanvas();k.emit(a,Ie,[bo(f.toDataURL("image/png"))],e.onOk),C()}}},[((g=i.value.clipModalTips)==null?void 0:g.buttonUpload)||((b=i.value.linkModalTips)==null?void 0:b.buttonOK)])]),s("input",{ref:v,accept:"image/*",type:"file",multiple:!1,style:{display:"none"}},null)]}})}}}),$n={type:{type:String,default:"link"},linkVisible:{type:Boolean,default:!1},clipVisible:{type:Boolean,default:!1},onCancel:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}}},wn=O({props:$n,setup(e){return()=>s(xe,null,[s(yn,{type:e.type,visible:e.linkVisible,onOk:e.onOk,onCancel:e.onCancel},null),s(Cn,{visible:e.clipVisible,onOk:e.onOk,onCancel:e.onCancel},null)])}}),Tn=O({name:"MDEditorToolbar",props:vn,setup(e){const t=E("editorId"),l=E("usedLanguageText"),n=E("theme"),i=E("previewTheme"),a=E("language"),{fullscreenHandler:u}=fn(e),v=`${t}-toolbar-wrapper`,d=R(),r=U({title:!1,catalog:!1,image:!1,table:!1,mermaid:!1,katex:!1}),o=(h,p)=>{k.emit(t,M,h,p)},m=U({type:"link",linkVisible:!1,clipVisible:!1}),C=R();N(()=>{k.on(t,{name:Oe,callback(h){m.type=h,m.linkVisible=!0}})});const $=G(()=>{const h=e.toolbars.filter(_=>!e.toolbarsExclude.includes(_)),p=h.indexOf("="),w=p===-1?h:h.slice(0,p+1),T=p===-1?[]:h.slice(p,Number.MAX_SAFE_INTEGER);return[w,T]}),g=R(),b=()=>{k.emit(t,Ie,Array.from(g.value.files||[])),g.value.value=""};N(()=>{g.value.addEventListener("change",b)});const f=h=>{var p,w,T,_,A,H,I,F,P,z,K,q,Y,le,ue,J,oe,ne,j,V,Le,We,Ue,ze,qe,Ge,Ke,Ze,Xe,Ye,Je,Qe,et,tt,lt,ot,nt,at,it,rt,st,ct,ut,dt,mt,vt,ft,gt,ht,bt,pt,yt,kt,Ct,$t,wt,Tt,_t,St,xt,Et,It,Lt,Ht,At,Mt,Ft,Pt,Bt;if(gl.includes(h))switch(h){case"-":return s(mn,null,null);case"bold":return s("div",{class:`${c}-toolbar-item`,title:(p=l.value.toolbarTips)==null?void 0:p.bold,onClick:()=>{o("bold")}},[s(x,{name:"bold"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(w=l.value.toolbarTips)==null?void 0:w.bold])]);case"underline":return s("div",{class:`${c}-toolbar-item`,title:(T=l.value.toolbarTips)==null?void 0:T.underline,onClick:()=>{o("underline")}},[s(x,{name:"underline"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(_=l.value.toolbarTips)==null?void 0:_.underline])]);case"italic":return s("div",{class:`${c}-toolbar-item`,title:(A=l.value.toolbarTips)==null?void 0:A.italic,onClick:()=>{o("italic")}},[s(x,{name:"italic"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(H=l.value.toolbarTips)==null?void 0:H.italic])]);case"strikeThrough":return s("div",{class:`${c}-toolbar-item`,title:(I=l.value.toolbarTips)==null?void 0:I.strikeThrough,onClick:()=>{o("strikeThrough")}},[s(x,{name:"strike-through"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(F=l.value.toolbarTips)==null?void 0:F.strikeThrough])]);case"title":return s(ve,{relative:`#${v}`,visible:r.title,onChange:L=>{r.title=L},overlay:s("ul",{class:`${c}-menu`,onClick:()=>{r.title=!1}},[s("li",{class:`${c}-menu-item ${c}-menu-item-title`,onClick:()=>{o("h1")}},[(P=l.value.titleItem)==null?void 0:P.h1]),s("li",{class:`${c}-menu-item ${c}-menu-item-title`,onClick:()=>{o("h2")}},[(z=l.value.titleItem)==null?void 0:z.h2]),s("li",{class:`${c}-menu-item ${c}-menu-item-title`,onClick:()=>{o("h3")}},[(K=l.value.titleItem)==null?void 0:K.h3]),s("li",{class:`${c}-menu-item ${c}-menu-item-title`,onClick:()=>{o("h4")}},[(q=l.value.titleItem)==null?void 0:q.h4]),s("li",{class:`${c}-menu-item ${c}-menu-item-title`,onClick:()=>{o("h5")}},[(Y=l.value.titleItem)==null?void 0:Y.h5]),s("li",{class:`${c}-menu-item ${c}-menu-item-title`,onClick:()=>{o("h6")}},[(le=l.value.titleItem)==null?void 0:le.h6])])},{default:()=>{var L,W;return[s("div",{class:`${c}-toolbar-item`,title:(L=l.value.toolbarTips)==null?void 0:L.title},[s(x,{name:"title"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(W=l.value.toolbarTips)==null?void 0:W.title])])]}});case"sub":return s("div",{class:`${c}-toolbar-item`,title:(ue=l.value.toolbarTips)==null?void 0:ue.sub,onClick:()=>{o("sub")}},[s(x,{name:"sub"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(J=l.value.toolbarTips)==null?void 0:J.sub])]);case"sup":return s("div",{class:`${c}-toolbar-item`,title:(oe=l.value.toolbarTips)==null?void 0:oe.sup,onClick:()=>{o("sup")}},[s(x,{name:"sup"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(ne=l.value.toolbarTips)==null?void 0:ne.sup])]);case"quote":return s("div",{class:`${c}-toolbar-item`,title:(j=l.value.toolbarTips)==null?void 0:j.quote,onClick:()=>{o("quote")}},[s(x,{name:"quote"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(V=l.value.toolbarTips)==null?void 0:V.quote])]);case"unorderedList":return s("div",{class:`${c}-toolbar-item`,title:(Le=l.value.toolbarTips)==null?void 0:Le.unorderedList,onClick:()=>{o("unorderedList")}},[s(x,{name:"unordered-list"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(We=l.value.toolbarTips)==null?void 0:We.unorderedList])]);case"orderedList":return s("div",{class:`${c}-toolbar-item`,title:(Ue=l.value.toolbarTips)==null?void 0:Ue.orderedList,onClick:()=>{o("orderedList")}},[s(x,{name:"ordered-list"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(ze=l.value.toolbarTips)==null?void 0:ze.orderedList])]);case"task":return s("div",{class:`${c}-toolbar-item`,title:(qe=l.value.toolbarTips)==null?void 0:qe.task,onClick:()=>{o("task")}},[s(x,{name:"task"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(Ge=l.value.toolbarTips)==null?void 0:Ge.task])]);case"codeRow":return s("div",{class:`${c}-toolbar-item`,title:(Ke=l.value.toolbarTips)==null?void 0:Ke.codeRow,onClick:()=>{o("codeRow")}},[s(x,{name:"code-row"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(Ze=l.value.toolbarTips)==null?void 0:Ze.codeRow])]);case"code":return s("div",{class:`${c}-toolbar-item`,title:(Xe=l.value.toolbarTips)==null?void 0:Xe.code,onClick:()=>{o("code")}},[s(x,{name:"code"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(Ye=l.value.toolbarTips)==null?void 0:Ye.code])]);case"link":return s("div",{class:`${c}-toolbar-item`,title:(Je=l.value.toolbarTips)==null?void 0:Je.link,onClick:()=>{m.type="link",m.linkVisible=!0}},[s(x,{name:"link"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(Qe=l.value.toolbarTips)==null?void 0:Qe.link])]);case"image":return e.noUploadImg?s("div",{class:`${c}-toolbar-item`,title:(et=l.value.toolbarTips)==null?void 0:et.image,onClick:()=>{m.type="image",m.linkVisible=!0}},[s(x,{name:"image"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(tt=l.value.toolbarTips)==null?void 0:tt.image])]):s(ve,{relative:`#${v}`,visible:r.image,onChange:L=>{r.image=L},overlay:s("ul",{class:`${c}-menu`,onClick:()=>{r.title=!1}},[s("li",{class:`${c}-menu-item ${c}-menu-item-image`,onClick:()=>{m.type="image",m.linkVisible=!0}},[(lt=l.value.imgTitleItem)==null?void 0:lt.link]),s("li",{class:`${c}-menu-item ${c}-menu-item-image`,onClick:()=>{g.value.click()}},[(ot=l.value.imgTitleItem)==null?void 0:ot.upload]),s("li",{class:`${c}-menu-item ${c}-menu-item-image`,onClick:()=>{m.clipVisible=!0}},[(nt=l.value.imgTitleItem)==null?void 0:nt.clip2upload])])},{default:()=>{var L,W;return[s("div",{class:`${c}-toolbar-item`,title:(L=l.value.toolbarTips)==null?void 0:L.image},[s(x,{name:"image"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(W=l.value.toolbarTips)==null?void 0:W.image])])]}});case"table":return s(ve,{relative:`#${v}`,visible:r.table,onChange:L=>{r.table=L},key:"bar-table",overlay:s(bn,{tableShape:e.tableShape,onSelected:L=>{o("table",{selectedShape:L})}},null)},{default:()=>{var L,W;return[s("div",{class:`${c}-toolbar-item`,title:(L=l.value.toolbarTips)==null?void 0:L.table},[s(x,{name:"table"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(W=l.value.toolbarTips)==null?void 0:W.table])])]}});case"revoke":return s("div",{class:`${c}-toolbar-item`,title:(at=l.value.toolbarTips)==null?void 0:at.revoke,onClick:()=>{k.emit(t,pl)}},[s(x,{name:"revoke"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(it=l.value.toolbarTips)==null?void 0:it.revoke])]);case"next":return s("div",{class:`${c}-toolbar-item`,title:(rt=l.value.toolbarTips)==null?void 0:rt.next,onClick:()=>{k.emit(t,yl)}},[s(x,{name:"next"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(st=l.value.toolbarTips)==null?void 0:st.next])]);case"save":return s("div",{class:`${c}-toolbar-item`,title:(ct=l.value.toolbarTips)==null?void 0:ct.save,onClick:()=>{k.emit(t,Ee)}},[s(x,{name:"baocun"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(ut=l.value.toolbarTips)==null?void 0:ut.save])]);case"prettier":return e.noPrettier?"":s("div",{class:`${c}-toolbar-item`,title:(dt=l.value.toolbarTips)==null?void 0:dt.prettier,onClick:()=>{o("prettier")}},[s(x,{name:"prettier"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(mt=l.value.toolbarTips)==null?void 0:mt.prettier])]);case"pageFullscreen":return!e.setting.fullscreen&&s("div",{class:`${c}-toolbar-item`,title:(vt=l.value.toolbarTips)==null?void 0:vt.pageFullscreen,onClick:()=>{e.updateSetting("pageFullscreen")}},[s(x,{name:e.setting.pageFullscreen?"suoxiao":"fangda"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(ft=l.value.toolbarTips)==null?void 0:ft.pageFullscreen])]);case"fullscreen":return s("div",{class:`${c}-toolbar-item`,title:(gt=l.value.toolbarTips)==null?void 0:gt.fullscreen,onClick:()=>{u()}},[s(x,{name:e.setting.fullscreen?"fullscreen-exit":"fullscreen"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(ht=l.value.toolbarTips)==null?void 0:ht.fullscreen])]);case"preview":return s("div",{class:`${c}-toolbar-item`,title:(bt=l.value.toolbarTips)==null?void 0:bt.preview,onClick:()=>{e.updateSetting("preview")}},[s(x,{name:"preview"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(pt=l.value.toolbarTips)==null?void 0:pt.preview])]);case"previewOnly":return s("div",{class:`${c}-toolbar-item`,title:(yt=l.value.toolbarTips)==null?void 0:yt.previewOnly,onClick:()=>{e.updateSetting("previewOnly")}},[s(x,{name:"preview-only"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(kt=l.value.toolbarTips)==null?void 0:kt.previewOnly])]);case"htmlPreview":return s("div",{class:`${c}-toolbar-item`,title:(Ct=l.value.toolbarTips)==null?void 0:Ct.htmlPreview,onClick:()=>{e.updateSetting("htmlPreview")}},[s(x,{name:"coding"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[($t=l.value.toolbarTips)==null?void 0:$t.htmlPreview])]);case"catalog":return s("div",{class:`${c}-toolbar-item`,title:(wt=l.value.toolbarTips)==null?void 0:wt.catalog,onClick:()=>{k.emit(t,je)},key:"bar-catalog"},[s(x,{name:"catalog"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(Tt=l.value.toolbarTips)==null?void 0:Tt.catalog])]);case"github":return s("div",{class:`${c}-toolbar-item`,title:(_t=l.value.toolbarTips)==null?void 0:_t.github,onClick:()=>Al("https://github.com/imzbf/md-editor-v3")},[s(x,{name:"github"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(St=l.value.toolbarTips)==null?void 0:St.github])]);case"mermaid":return s(ve,{relative:`#${v}`,visible:r.mermaid,onChange:L=>{r.mermaid=L},overlay:s("ul",{class:`${c}-menu`,onClick:()=>{r.mermaid=!1}},[s("li",{class:`${c}-menu-item ${c}-menu-item-mermaid`,onClick:()=>{o("flow")}},[(xt=l.value.mermaid)==null?void 0:xt.flow]),s("li",{class:`${c}-menu-item ${c}-menu-item-mermaid`,onClick:()=>{o("sequence")}},[(Et=l.value.mermaid)==null?void 0:Et.sequence]),s("li",{class:`${c}-menu-item ${c}-menu-item-mermaid`,onClick:()=>{o("gantt")}},[(It=l.value.mermaid)==null?void 0:It.gantt]),s("li",{class:`${c}-menu-item ${c}-menu-item-mermaid`,onClick:()=>{o("class")}},[(Lt=l.value.mermaid)==null?void 0:Lt.class]),s("li",{class:`${c}-menu-item ${c}-menu-item-mermaid`,onClick:()=>{o("state")}},[(Ht=l.value.mermaid)==null?void 0:Ht.state]),s("li",{class:`${c}-menu-item ${c}-menu-item-mermaid`,onClick:()=>{o("pie")}},[(At=l.value.mermaid)==null?void 0:At.pie]),s("li",{class:`${c}-menu-item ${c}-menu-item-mermaid`,onClick:()=>{o("relationship")}},[(Mt=l.value.mermaid)==null?void 0:Mt.relationship]),s("li",{class:`${c}-menu-item ${c}-menu-item-mermaid`,onClick:()=>{o("journey")}},[(Ft=l.value.mermaid)==null?void 0:Ft.journey])]),key:"bar-mermaid"},{default:()=>{var L,W;return[s("div",{class:`${c}-toolbar-item`,title:(L=l.value.toolbarTips)==null?void 0:L.mermaid},[s(x,{name:"mermaid"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(W=l.value.toolbarTips)==null?void 0:W.mermaid])])]}});case"katex":return s(ve,{relative:`#${v}`,visible:r.katex,onChange:L=>{r.katex=L},overlay:s("ul",{class:`${c}-menu`,onClick:()=>{r.katex=!1}},[s("li",{class:`${c}-menu-item ${c}-menu-item-katex`,onClick:()=>{o("katexInline")}},[(Pt=l.value.katex)==null?void 0:Pt.inline]),s("li",{class:`${c}-menu-item ${c}-menu-item-katex`,onClick:()=>{o("katexBlock")}},[(Bt=l.value.katex)==null?void 0:Bt.block])]),key:"bar-katex"},{default:()=>{var L,W;return[s("div",{class:`${c}-toolbar-item`,title:(L=l.value.toolbarTips)==null?void 0:L.katex},[s(x,{name:"formula"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(W=l.value.toolbarTips)==null?void 0:W.katex])])]}})}else if(e.defToolbars instanceof Array){const L=e.defToolbars[h];return L?Ne(L,{theme:n.value,previewTheme:i.value,language:a.value,insert(He){k.emit(t,M,"universal",{generate:He})}}):""}else if(e.defToolbars&&e.defToolbars.children instanceof Array){const L=e.defToolbars.children[h];return L?Ne(L,{theme:n.value,previewTheme:i.value,language:a.value,insert(He){k.emit(t,M,"universal",{generate:He})}}):""}else return""};return S(()=>e.toolbars,()=>{te(()=>{d.value&&Hl(d.value)})},{immediate:!0}),()=>{const h=$.value[0].map(w=>f(w)),p=$.value[1].map(w=>f(w));return s(xe,null,[e.toolbars.length>0&&s("div",{class:`${c}-toolbar-wrapper`,ref:d,id:v},[s("div",{class:[`${c}-toolbar`,e.showToolbarName&&`${c}-stn`]},[s("div",{class:`${c}-toolbar-left`,ref:C},[h]),s("div",{class:`${c}-toolbar-right`},[p])])]),s("input",{ref:g,accept:"image/*",type:"file",multiple:!0,style:{display:"none"}},null),s(wn,{linkVisible:m.linkVisible,clipVisible:m.clipVisible,type:m.type,onCancel:()=>{m.linkVisible=!1,m.clipVisible=!1},onOk:w=>{w&&o(m.type,{desc:w.desc,url:w.url,transform:m.type==="image"}),m.linkVisible=!1,m.clipVisible=!1}},null)])}}}),_n=`.${c}-preview > [data-line]`,Sn=(e,t)=>{const l=Se(()=>{e.removeEventListener("scroll",n),e.addEventListener("scroll",n),t.removeEventListener("scroll",n),t.addEventListener("scroll",n)},50),n=i=>{const a=e.clientHeight,u=t.clientHeight,v=e.scrollHeight,d=t.scrollHeight,r=(v-a)/(d-u);i.target===e?(t.removeEventListener("scroll",n),t.scrollTo({top:e.scrollTop/r}),l()):(e.removeEventListener("scroll",n),e.scrollTo({top:t.scrollTop*r}),l())};return[()=>{l().finally(()=>{e.dispatchEvent(new Event("scroll"))})},()=>{e.removeEventListener("scroll",n),t.removeEventListener("scroll",n)}]},xn=(e,t,l)=>{const{view:n}=l,i=Ml(),a=f=>n.lineBlockAt(n.state.doc.line(f).from).top,u=f=>n.lineBlockAt(n.state.doc.line(f).from).height;let v=[],d=[],r=[];const o=()=>{v=[],d=[],r=[],d=d.concat(Array.from(t.querySelectorAll(_n)));const f=d.map(T=>Number(T.dataset.line)+1);r=r.concat(f);const{lines:h}=n.state.doc;let p=1,w=f.shift()??h;for(let T=1;T<=h;T++)T===w&&(p=T,w=f.shift()||h+1),v.push({start:p,end:w-1})};let m=0,C=0;const $=()=>{var f,h;if(C!==0)return!1;m++;const{scrollDOM:p,contentHeight:w}=n;let T=+getComputedStyle(t).paddingTop.replace("px","");const _=n.lineBlockAtHeight(p.scrollTop),{number:A}=n.state.doc.lineAt(_.from),H=v[A-1];if(!H)return!1;let I=a(H.end)+u(H.end),F=0;const P=a(H.start),z=t.querySelector(`[data-line="${H.start-1}"]`)||((f=t.firstElementChild)==null?void 0:f.firstElementChild),K=t.querySelector(`[data-line="${H.end}"]`)||((h=t.lastElementChild)==null?void 0:h.lastElementChild);let q=0,Y=0;P===0?(F=p.scrollTop/I,z===K?(T=0,I=w-p.offsetHeight,q=K.offsetTop+K.offsetHeight-t.clientHeight):q=K.offsetTop):(F=(p.scrollTop-P)/(I-P),Y=z.offsetTop,q=K.offsetTop-Y),I>p.scrollHeight-p.clientHeight&&(F=(p.scrollTop-P)/(p.scrollHeight-p.clientHeight-P),Y=z.offsetTop,q=t.scrollHeight-t.clientHeight-Y+10);const le=Y-T+q*F;i(t,le,()=>{m--})},g=()=>{var f,h,p,w,T,_;if(m!==0)return;C++;const{scrollDOM:A}=n,H=t.scrollTop,I=t.scrollHeight;let F=(f=t.firstElementChild)==null?void 0:f.firstElementChild,P=(h=t.firstElementChild)==null?void 0:h.lastElementChild;if(r.length>0){let ne=Math.ceil(Number(r[r.length-1])*(H/I)),j=r.findLastIndex(V=>V<=ne);j=j===-1?0:j,ne=r[j];for(let V=j;V>=0&&V<r.length;)if(d[V].offsetTop>H){if(V-1>=0){V--;continue}ne=-1,j=V;break}else{if(V+1<r.length&&d[V+1].offsetTop<H){V++;continue}ne=r[V],j=V;break}switch(ne){case-1:{F=(p=t.firstElementChild)==null?void 0:p.firstElementChild,P=d[j];break}case r.length-1:{F=d[j],P=(w=t.firstElementChild)==null?void 0:w.lastElementChild;break}default:F=d[j],P=d[j+1===d.length?j:j+1]}}const z=F===((T=t.firstElementChild)==null?void 0:T.firstElementChild)?0:F.offsetTop;let K=P.offsetTop,q=0;const{start:Y,end:le}=v[Number(F.dataset.line||0)],ue=a(Y);let J=a(le===n.state.doc.lines?le:le+1),oe=0;J>A.scrollHeight-A.clientHeight||P.scrollTop>t.scrollHeight-t.clientHeight?(q=Math.max((H-z)/(t.scrollHeight-z-t.clientHeight),0),J=a(n.state.doc.lines)+u(n.state.doc.lines),oe=8+J-ue-e.clientHeight):F===((_=t.firstElementChild)==null?void 0:_.firstElementChild)?(F===P&&(K=P.offsetTop+P.offsetHeight+ +getComputedStyle(P).marginBottom.replace("px","")),oe=J,q=Math.max(H/K,0)):(q=Math.max((H-z)/(K-z),0),oe=J-ue),i(e,ue+oe*q,()=>{C--})},b=ml(f=>{var h;const{scrollDOM:p,contentHeight:w}=n,T=p.clientHeight;if(w<=T||t.firstElementChild.clientHeight<=t.clientHeight||n.state.doc.lines<((h=v[v.length-1])==null?void 0:h.end))return!1;f.target===e?$():g()},1);return[()=>{o(),e.addEventListener("scroll",b),t.addEventListener("scroll",b),e.dispatchEvent(new Event("scroll"))},()=>{e.removeEventListener("scroll",b),t.removeEventListener("scroll",b)}]},En=(e,t,l)=>{const n=E("editorId");let i=()=>{},a=()=>{};const u=()=>{i();const v=document.querySelector(`#${n} .cm-scroller`),d=document.querySelector(`[id="${n}-preview-wrapper"]`),r=document.querySelector(`[id="${n}-html-wrapper"]`);(d||r)&&([a,i]=(d?xn:Sn)(v,d||r,l.value),e.scrollAuto&&a())};S([t,re(e.setting,"preview"),re(e.setting,"htmlPreview"),re(e.setting,"fullscreen"),re(e.setting,"pageFullscreen")],()=>{te(u)}),S(()=>e.scrollAuto,v=>{v?a():i()}),S(()=>e.setting.previewOnly,v=>{v?i():a()}),N(u)},Me=(e,t,l)=>{var n,i,a,u,v,d;let r="",o=0,m=0,C=!0,$=!1;const g=t.getSelectedText(),b=(n=D.editorConfig)==null?void 0:n.mermaidTemplate;if(/^h[1-6]{1}$/.test(e)){const f=e.replace(/^h(\d)/,(h,p)=>new Array(Number(p)).fill("#",0,p).join(""));r=`${f} ${g}`,o=f.length+1}else if(e==="prettier"){const f=window.prettier||((a=(i=D.editorExtensions)==null?void 0:i.prettier)==null?void 0:a.prettierInstance),h=[((u=window.prettierPlugins)==null?void 0:u.markdown)||((d=(v=D.editorExtensions)==null?void 0:v.prettier)==null?void 0:d.parserMarkdownInstance)];!f||h[0]===void 0?(k.emit(l.editorId,ce,{name:"prettier",message:"prettier is undefined"}),r=t.getValue()):r=f.format(t.getValue(),{parser:"markdown",plugins:h}),C=!1,$=!0}else switch(e){case"bold":{r=`**${g}**`,o=2,m=-2;break}case"underline":{r=`<u>${g}</u>`,o=3,m=-4;break}case"italic":{r=`*${g}*`,o=1,m=-1;break}case"strikeThrough":{r=`~~${g}~~`,o=2,m=-2;break}case"sub":{r=`<sub>${g}</sub>`,o=5,m=-6;break}case"sup":{r=`<sup>${g}</sup>`,o=5,m=-6;break}case"codeRow":{r="`"+g+"`",o=1,m=-1;break}case"quote":{r=`> ${g}`,o=2;break}case"orderedList":{r=`1. ${g}`,o=3;break}case"unorderedList":{r=`- ${g}`,o=2;break}case"task":{r=`- [ ] ${g}`,o=6;break}case"code":{const f=l.text||g||"",h=l.mode||"language";r=`\`\`\`${h}
${f}
\`\`\`
`,o=3,m=3+h.length-r.length;break}case"table":{r="|";const{selectedShape:f={x:1,y:1}}=l,{x:h,y:p}=f;for(let w=0;w<=p;w++)r+=" col |";r+=`
|`;for(let w=0;w<=p;w++)r+=" - |";for(let w=0;w<=h;w++){r+=`
|`;for(let T=0;T<=p;T++)r+=" content |"}o=2,m=5-r.length;break}case"link":{const{desc:f,url:h}=l;r=`[${f}](${h})`,C=!1;break}case"image":{const{desc:f,url:h,urls:p}=l;p instanceof Array?r=p.reduce((w,T)=>{const{url:_="",alt:A="",title:H=""}=typeof T=="object"?T:{url:T};return w+`![${A}](${_}${H?" '"+H+"'":""})
`},""):r=`![${f}](${h})
`,C=!1;break}case"flow":{r=`\`\`\`mermaid
${(b==null?void 0:b.flow)||`flowchart TD 
  Start --> Stop`}
\`\`\`
`,o=3,m=10-r.length;break}case"sequence":{r=`\`\`\`mermaid
${(b==null?void 0:b.sequence)||`sequenceDiagram
  A->>B: hello!
  B-->>A: hi!
  A-)B: bye!`}
\`\`\`
`,o=3,m=10-r.length;break}case"gantt":{r=`\`\`\`mermaid
${(b==null?void 0:b.gantt)||`gantt
title A Gantt Diagram
dateFormat  YYYY-MM-DD
section Section
A task  :a1, 2014-01-01, 30d
Another task  :after a1, 20d`}
\`\`\`
`,o=3,m=10-r.length;break}case"class":{r=`\`\`\`mermaid
${(b==null?void 0:b.class)||`classDiagram
  class Animal
  Vehicle <|-- Car`}
\`\`\`
`,o=3,m=10-r.length;break}case"state":{r=`\`\`\`mermaid
${(b==null?void 0:b.state)||`stateDiagram-v2
  s1 --> s2`}
\`\`\`
`,o=3,m=10-r.length;break}case"pie":{r=`\`\`\`mermaid
${(b==null?void 0:b.pie)||`pie title Pets adopted by volunteers
  "Dogs" : 386
  "Cats" : 85
  "Rats" : 15`}
\`\`\`
`,o=3,m=10-r.length;break}case"relationship":{r=`\`\`\`mermaid
${(b==null?void 0:b.relationship)||`erDiagram
  CAR ||--o{ NAMED-DRIVER : allows
  PERSON ||--o{ NAMED-DRIVER : is`}
\`\`\`
`,o=3,m=10-r.length;break}case"journey":{r=`\`\`\`mermaid
${(b==null?void 0:b.journey)||`journey
  title My working day
  section Go to work
    Make tea: 5: Me
    Go upstairs: 3: Me
    Do work: 1: Me, Cat
  section Go home
    Go downstairs: 5: Me
    Sit down: 5: Me`}
\`\`\`
`,o=3,m=10-r.length;break}case"katexInline":{r="$$",o=1,m=-1;break}case"katexBlock":{r=`$$

$$
`,o=3,m=-4;break}case"universal":{const{generate:f}=l,h=f(g);r=h.targetValue,C=h.select??!0,o=h.deviationStart||0,m=h.deviationEnd||0}}return{text:r,options:{select:C,deviationStart:o,deviationEnd:m,replaceAll:$}}},In="#e5c07b",Jt="var(--md-color)",Ln="#56b6c2",Hn="#ffffff",ge="var(--md-color)",Qt="#e5c07b",An="#e5c07b",Mn="var(--md-color)",el="#d19a66",Fn="#c678dd",Pn="#21252b",Bn="#2c313a",tl="var(--md-bk-color)",Fe="var(--md-bk-color)",Rn="#ceedfa33",ll="#528bff",Nn=ie.theme({"&":{color:ge,backgroundColor:tl},".cm-content":{caretColor:ll},".cm-cursor, .cm-dropCursor":{borderLeftColor:ll},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:Rn},".cm-panels":{backgroundColor:Pn,color:ge},".cm-panels.cm-panels-top":{borderBottom:"1px solid var(--md-border-color)"},".cm-panels.cm-panels-bottom":{borderTop:"1px solid var(--md-border-color)"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#ceedfa33"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:tl,color:ge,borderRight:"1px solid",borderColor:"var(--md-border-color)"},".cm-activeLineGutter":{backgroundColor:Bn},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"1px solid var(--md-border-color)",backgroundColor:Fe},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:Fe,borderBottomColor:Fe},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{color:ge}}},{dark:!0}),On=vl.define([{tag:y.keyword,color:Fn},{tag:[y.name,y.deleted,y.character,y.propertyName,y.macroName],color:Jt},{tag:[y.function(y.variableName),y.labelName],color:An},{tag:[y.color,y.constant(y.name),y.standard(y.name)],color:el},{tag:[y.definition(y.name),y.separator],color:ge},{tag:[y.typeName,y.className,y.number,y.changed,y.annotation,y.modifier,y.self,y.namespace],color:In},{tag:[y.operator,y.operatorKeyword,y.url,y.escape,y.regexp,y.link,y.special(y.string)],color:Ln},{tag:[y.meta,y.comment],color:Qt},{tag:y.strong,fontWeight:"bold"},{tag:y.emphasis,fontStyle:"italic"},{tag:y.strikethrough,textDecoration:"line-through"},{tag:y.link,color:Qt,textDecoration:"underline"},{tag:y.heading,fontWeight:"bold",color:Jt},{tag:[y.atom,y.bool,y.special(y.variableName)],color:el},{tag:[y.processingInstruction,y.string,y.inserted],color:Mn},{tag:y.invalid,color:Hn}]),ol=[Nn,fl(On)],Dn="#e5c07b",nl="#3f4a54",jn="#56b6c2",Vn="#fff",he="#3f4a54",al="#2d8cf0",Wn="#2d8cf0",Un="#3f4a54",il="#d19a66",zn="#c678dd",qn="#f6f6f6",Gn="#ceedfa33",rl="var(--md-bk-color)",Pe="var(--md-bk-color)",Kn="#bad5fa",sl="#3f4a54",Zn=ie.theme({"&":{color:he,backgroundColor:rl},".cm-content":{caretColor:sl},".cm-cursor, .cm-dropCursor":{borderLeftColor:sl},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:Kn},".cm-panels":{backgroundColor:qn,color:he},".cm-panels.cm-panels-top":{borderBottom:"1px solid var(--md-border-color)"},".cm-panels.cm-panels-bottom":{borderTop:"1px solid var(--md-border-color)"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#ceedfa33"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:rl,color:he,borderRight:"1px solid",borderColor:"var(--md-border-color)"},".cm-activeLineGutter":{backgroundColor:Gn},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"1px solid var(--md-border-color)",backgroundColor:Pe},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:Pe,borderBottomColor:Pe},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{color:he}}}),Xn=vl.define([{tag:y.keyword,color:zn},{tag:[y.name,y.deleted,y.character,y.propertyName,y.macroName],color:nl},{tag:[y.function(y.variableName),y.labelName],color:Wn},{tag:[y.color,y.constant(y.name),y.standard(y.name)],color:il},{tag:[y.definition(y.name),y.separator],color:he},{tag:[y.typeName,y.className,y.number,y.changed,y.annotation,y.modifier,y.self,y.namespace],color:Dn},{tag:[y.operator,y.operatorKeyword,y.url,y.escape,y.regexp,y.link,y.special(y.string)],color:jn},{tag:[y.meta,y.comment],color:al},{tag:y.strong,fontWeight:"bold"},{tag:y.emphasis,fontStyle:"italic"},{tag:y.strikethrough,textDecoration:"line-through"},{tag:y.link,color:al,textDecoration:"underline"},{tag:y.heading,fontWeight:"bold",color:nl},{tag:[y.atom,y.bool,y.special(y.variableName)],color:il},{tag:[y.processingInstruction,y.string,y.inserted],color:Un},{tag:y.invalid,color:Vn}]),cl=[Zn,fl(Xn)],ke=(e,t,l,n,i)=>(a,u,v,d)=>{const r=`${e}${t}`.slice(d-v);a.dispatch(a.state.replaceSelection(`${r}${l}${n}`));const o=v+u.label.length+(i==="title"?l.length:0);a.dispatch({selection:ee.create([ee.range(v+u.label.length+(i==="title"?1:-t.length),o),ee.cursor(o)],1)}),a.focus()},ul=e=>(t,l,n,i)=>{const a=e.slice(i-n);t.dispatch(t.state.replaceSelection(`${a} `))},dl=e=>{const t=l=>{const n=l.matchBefore(/^#+|^-\s*\[*\s*\]*|`+|\[|!\[*|^\|\s?\|?|\$\$?|!+\s*\w*/);return n===null||n.from==n.to&&l.explicit?null:{from:n.from,options:[...["h1","h2","h3","h4","h5","h6"].map((i,a)=>{const u=new Array(a+1).fill("#").join("");return{label:u,type:"text",apply:ul(u)}}),...["unchecked","checked"].map(i=>{const a=i==="checked"?"- [x]":"- [ ]";return{label:a,type:"text",apply:ul(a)}}),...[["`",""],["```","language"],["```mermaid\n",""]].map(i=>({label:`${i[0]}${i[1]}`,type:"text",apply:ke(i[0],i[1],"",i[0]==="`"?"`":"\n```","type")})),{label:"[]()",type:"text"},{label:"![]()",type:"text"},{label:"| |",type:"text",detail:"table",apply:`| col | col | col |
| - | - | - |
| content | content | content |
| content | content | content |`},{label:"$",type:"text",apply:ke("$","","","$","type")},{label:"$$",type:"text",apply:ke("$$","",`
`,`
$$`,"title")},...["note","abstract","info","tip","success","question","warning","failure","danger","bug","example","quote","hint","caution","error","attention"].map(i=>({label:`!!! ${i}`,type:"text",apply:ke("!!!",` ${i}`," Title",`

!!!`,"title")}))]}};return zl({override:e?[t,...e]:[t]})},de=e=>{const t=new me;return n=>(t.get(e.state)?e.dispatch({effects:t.reconfigure(n)}):e.dispatch({effects:Xl.appendConfig.of(t.of(n))}),!0)};class Yn{constructor(t){ae(this,"view"),ae(this,"maxLength",Number.MAX_SAFE_INTEGER),ae(this,"toggleTabSize"),ae(this,"togglePlaceholder"),ae(this,"setExtensions"),ae(this,"toggleDisabled"),ae(this,"toggleReadOnly"),ae(this,"toggleMaxlength"),this.view=t,this.toggleTabSize=de(this.view),this.togglePlaceholder=de(this.view),this.setExtensions=de(this.view),this.toggleDisabled=de(this.view),this.toggleReadOnly=de(this.view),this.toggleMaxlength=de(this.view)}getValue(){return this.view.state.doc.toString()}setValue(t,l=0,n=this.view.state.doc.length){this.view.dispatch({changes:{from:l,to:n,insert:t}})}getSelectedText(){const{from:t,to:l}=this.view.state.selection.main;return this.view.state.sliceDoc(t,l)}replaceSelectedText(t,l={select:!0,deviationStart:0,deviationEnd:0,replaceAll:!1},n){try{if(l.replaceAll){if(this.setValue(t),t.length>this.maxLength)throw new Error("The input text is too long");return}if(this.view.state.doc.length-this.getSelectedText().length+t.length>this.maxLength)throw new Error("The input text is too long");const{from:i}=this.view.state.selection.main;if(this.view.dispatch(this.view.state.replaceSelection(t)),l.select){const a=i+t.length+l.deviationEnd;this.view.dispatch({selection:ee.create([ee.range(i+l.deviationStart,a),ee.cursor(a)],1)})}this.view.focus()}catch(i){if(i.message==="The input text is too long")k.emit(n,ce,{name:"overlength",message:i.message,data:t});else throw i}}setTabSize(t){this.toggleTabSize([Ae.tabSize.of(t),ql.of(" ".repeat(t))])}setPlaceholder(t){this.togglePlaceholder(Gl(t))}focus(t){if(this.view.focus(),!t)return;let l=0,n=0,i=0;switch(t){case"start":break;case"end":{l=n=i=this.getValue().length;break}default:l=t.rangeAnchor||t.cursorPos,n=t.rangeHead||t.cursorPos,i=t.cursorPos}this.view.dispatch({scrollIntoView:!0,selection:ee.create([ee.range(l,n),ee.cursor(i)],1)})}setDisabled(t){this.toggleDisabled([ie.editable.of(!t)])}setReadOnly(t){this.toggleReadOnly([Ae.readOnly.of(t)])}setMaxLength(t){this.maxLength=t,this.toggleMaxlength([Ae.changeFilter.of(l=>l.newDoc.length<=t)])}}const Jn=(e,t)=>{const l=E("editorId"),n=a=>{a instanceof Promise?a.then(u=>{k.emit(l,M,"universal",{generate(){return{targetValue:u}}})}).catch(u=>{console.error(u)}):k.emit(l,M,"universal",{generate(){return{targetValue:a}}})};return a=>{var u,v,d;if(!a.clipboardData)return;if(a.clipboardData.files.length>0){const{files:b}=a.clipboardData;k.emit(l,Ie,Array.from(b).filter(f=>/image\/.*/.test(f.type))),a.preventDefault();return}const r=a.clipboardData.getData("text/plain"),o=((u=t.value)==null?void 0:u.view.state.selection.main.to)||0,m=((v=t.value)==null?void 0:v.view.state.doc.lineAt(o).from)||0,C=((d=t.value)==null?void 0:d.view.state.doc.sliceString(m,o))||"",$=/!\[.*\]\(\s*$/.test(C),g=/!\[.*\]\((.*)\s?.*\)/.test(r);if($){const b=e.transformImgUrl(r);n(b),a.preventDefault();return}else if(g){const b=r.match(new RegExp(`(?<=!\\[.*\\]\\()([^)\\s]+)(?=\\s?["']?.*["']?\\))`,"g"));b?Promise.all(b.map(f=>e.transformImgUrl(f))).then(f=>{n(f.reduce((h,p,w)=>h.replace(b[w],p),r))}):n(r),a.preventDefault();return}if(e.autoDetectCode&&a.clipboardData.types.includes("vscode-editor-data")){const b=JSON.parse(a.clipboardData.getData("vscode-editor-data"));k.emit(l,M,"code",{mode:b.mode,text:a.clipboardData.getData("text/plain")}),a.preventDefault();return}e.maxlength&&r.length+e.modelValue.length>e.maxlength&&k.emit(l,ce,{name:"overlength",message:"The input text is too long",data:r})}},Qn=(e,t)=>[{key:"Ctrl-b",mac:"Cmd-b",run:()=>(k.emit(e,M,"bold"),!0)},{key:"Ctrl-d",mac:"Cmd-d",run:Yl,preventDefault:!0},{key:"Ctrl-s",mac:"Cmd-s",run:T=>(k.emit(e,Ee,T.state.doc.toString()),!0),shift:()=>(k.emit(e,M,"strikeThrough"),!0)},{key:"Ctrl-u",mac:"Cmd-u",run:()=>(k.emit(e,M,"underline"),!0),shift:()=>(k.emit(e,M,"unorderedList"),!0)},{key:"Ctrl-i",mac:"Cmd-i",run:()=>(k.emit(e,M,"italic"),!0),shift:()=>(k.emit(e,Oe,"image"),!0)},{key:"Ctrl-1",mac:"Cmd-1",run:()=>(k.emit(e,M,"h1"),!0)},{key:"Ctrl-2",mac:"Cmd-2",run:()=>(k.emit(e,M,"h2"),!0)},{key:"Ctrl-3",mac:"Cmd-3",run:()=>(k.emit(e,M,"h3"),!0)},{key:"Ctrl-4",mac:"Cmd-4",run:()=>(k.emit(e,M,"h4"),!0)},{key:"Ctrl-5",mac:"Cmd-5",run:()=>(k.emit(e,M,"h5"),!0)},{key:"Ctrl-6",mac:"Cmd-6",run:()=>(k.emit(e,M,"h6"),!0)},{key:"Ctrl-ArrowUp",mac:"Cmd-ArrowUp",run:()=>(k.emit(e,M,"sup"),!0)},{key:"Ctrl-ArrowDown",mac:"Cmd-ArrowDown",run:()=>(k.emit(e,M,"sub"),!0)},{key:"Ctrl-o",mac:"Cmd-o",run:()=>(k.emit(e,M,"orderedList"),!0)},{key:"Ctrl-c",mac:"Cmd-c",shift:()=>(k.emit(e,M,"code"),!0),any(T,_){return(_.ctrlKey||_.metaKey)&&_.altKey&&_.code==="KeyC"?(k.emit(e,M,"codeRow"),!0):!1}},{key:"Ctrl-l",mac:"Cmd-l",run:()=>(k.emit(e,Oe,"link"),!0)},{key:"Ctrl-f",mac:"Cmd-f",shift:()=>t.noPrettier?!1:(k.emit(e,M,"prettier"),!0)},{any:(T,_)=>(_.ctrlKey||_.metaKey)&&_.altKey&&_.shiftKey&&_.code==="KeyT"?(k.emit(e,M,"table"),!0):!1},...Zl],ea=e=>{const t=E("tabWidth"),l=E("editorId"),n=E("theme"),i=R(),a=se(),u=new me,v=new me,d=new me,r=new me,o=new me,m=Qn(l,e),C=R(!1),g={paste:Jn(e,a),blur:e.onBlur,focus:e.onFocus,drop:e.onDrop,compositionstart:()=>{C.value=!0},compositionend:(h,p)=>{C.value=!1,e.updateModelValue(p.state.doc.toString())},input:h=>{e.onInput&&e.onInput(h);const{data:p}=h;e.maxlength&&e.modelValue.length+p.length>e.maxlength&&k.emit(l,ce,{name:"overlength",message:"The input text is too long",data:p})}},b=[Nl.of([...Ol,...Dl,...m,jl]),r.of(Rt()),u.of(Vl({codeLanguages:Kl})),ie.lineWrapping,ie.updateListener.of(h=>{h.docChanged&&(e.onChange(h.state.doc.toString()),C.value||e.updateModelValue(h.state.doc.toString()))}),o.of(ie.domEventHandlers(g))],f=()=>{const h=[...b,v.of(n.value==="light"?cl:ol),d.of(dl(e.completions))];return D.codeMirrorExtensions(n.value,h,[...m])};return N(()=>{const h=new ie({doc:e.modelValue,parent:i.value,extensions:[f()]}),p=new Yn(h);a.value=p,setTimeout(()=>{p.setTabSize(t),p.setDisabled(e.disabled),p.setReadOnly(e.readonly),e.placeholder&&p.setPlaceholder(e.placeholder),typeof e.maxlength=="number"&&p.setMaxLength(e.maxlength),e.autofocus&&h.focus()},0),k.on(l,{name:pl,callback(){Wl(h)}}),k.on(l,{name:yl,callback(){Ul(h)}}),k.on(l,{name:M,callback(w,T={}){var _,A;if(w==="image"&&T.transform){const H=e.transformImgUrl(T.url);if(H instanceof Promise)H.then(I=>{var F;const{text:P,options:z}=Me(w,a.value,{...T,url:I});(F=a.value)==null||F.replaceSelectedText(P,z,l)}).catch(I=>{console.error(I)});else{const{text:I,options:F}=Me(w,a.value,{...T,url:H});(_=a.value)==null||_.replaceSelectedText(I,F,l)}}else{const{text:H,options:I}=Me(w,a.value,T);(A=a.value)==null||A.replaceSelectedText(H,I,l)}}}),k.on(l,{name:Cl,callback:ml(w=>{var T;const _={...g},A=Object.keys(g);for(const H in w){const I=H;A.includes(I)?_[I]=(F,P)=>{w[I](F,P),F.defaultPrevented||g[I](F,P)}:_[I]=w[I]}(T=a.value)==null||T.view.dispatch({effects:o.reconfigure(ie.domEventHandlers(_))})})})}),S(n,()=>{var h;(h=a.value)==null||h.view.dispatch({effects:v.reconfigure(n.value==="light"?cl:ol)})},{deep:!0}),S(()=>e.completions,()=>{var h;(h=a.value)==null||h.view.dispatch({effects:d.reconfigure(dl(e.completions))})},{deep:!0}),S(()=>e.modelValue,()=>{var h,p;((h=a.value)==null?void 0:h.getValue())!==e.modelValue&&((p=a.value)==null||p.setValue(e.modelValue))}),S(()=>e.placeholder,()=>{var h;(h=a.value)==null||h.setPlaceholder(e.placeholder)}),S(()=>e.disabled,()=>{var h;(h=a.value)==null||h.setDisabled(e.disabled)}),S(()=>e.readonly,()=>{var h;(h=a.value)==null||h.setDisabled(e.readonly)}),S(()=>e.maxlength,()=>{var h;e.maxlength&&((h=a.value)==null||h.setMaxLength(e.maxlength))}),{inputWrapperRef:i,codeMirrorUt:a,resetHistory(){var h,p;(h=a.value)==null||h.view.dispatch({effects:r.reconfigure([])}),(p=a.value)==null||p.view.dispatch({effects:r.reconfigure(Rt())})}}},ta=(e,t,l)=>{const n=U({resizedWidth:e.inputBoxWitdh}),i=U({width:e.inputBoxWitdh}),a=U({left:e.inputBoxWitdh,display:"initial"}),u=r=>{var o,m,C;const $=((o=t.value)==null?void 0:o.offsetWidth)||0,g=((m=t.value)==null?void 0:m.getBoundingClientRect().x)||0;let b=r.x-g;b<ye?b=ye:b>$-ye&&(b=$-ye);const f=`${b}px`;i.width=f,a.left=f,n.resizedWidth=f,(C=e.onInputBoxWitdhChange)==null||C.call(e,f)},v=()=>{document.addEventListener("mousemove",u)},d=()=>{document.removeEventListener("mousemove",u)};return N(()=>{var r;(r=l.value)==null||r.addEventListener("mousedown",v),document.addEventListener("mouseup",d)}),pe(()=>{var r,o;(r=l.value)==null||r.removeEventListener("mousedown",v),(o=l.value)==null||o.removeEventListener("mouseup",d)}),S(()=>e.inputBoxWitdh,r=>{r&&(i.width=r,a.left=r)}),S([re(e.setting,"htmlPreview"),re(e.setting,"preview")],()=>{!e.setting.htmlPreview&&!e.setting.preview?(i.width="100%",a.display="none"):(i.width=n.resizedWidth,a.display="initial")},{immediate:!0}),S(()=>e.setting.previewOnly,r=>{r?(i.width="0%",a.display="none"):(i.width=n.resizedWidth,a.display="initial")}),{inputWrapperStyle:i,resizeOperateStyle:a}},la=O({name:"MDEditorContent",props:zo,setup(e,t){const l=E("editorId"),n=R(""),i=R(),a=R(),{inputWrapperRef:u,codeMirrorUt:v,resetHistory:d}=ea(e),{inputWrapperStyle:r,resizeOperateStyle:o}=ta(e,i,a);return En(e,n,v),t.expose({getSelectedText(){var m;return(m=v.value)==null?void 0:m.getSelectedText()},focus(m){var C;(C=v.value)==null||C.focus(m)},resetHistory:d}),()=>s("div",{class:`${c}-content${e.setting.htmlPreview||e.setting.preview?" has-preview":""}`,ref:i},[s("div",{class:`${c}-input-wrapper`,style:r,ref:u},null),(e.setting.htmlPreview||e.setting.preview)&&s("div",{class:`${c}-resize-operate`,style:o,ref:a},null),s(wl,{modelValue:e.modelValue,setting:e.setting,onHtmlChanged:m=>{n.value=m,e.onHtmlChanged(m)},onGetCatalog:e.onGetCatalog,mdHeadingId:e.mdHeadingId,noMermaid:e.noMermaid,sanitize:e.sanitize,noKatex:e.noKatex,formatCopiedText:e.formatCopiedText,noHighlight:e.noHighlight,noImgZoomIn:e.noImgZoomIn,sanitizeMermaid:e.sanitizeMermaid},null),e.catalogVisible&&s(be,{theme:e.theme,class:`${c}-catalog-editor`,editorId:l,mdHeadingId:e.mdHeadingId,key:"internal-catalog"},null)])}}),oa=O({props:{modelValue:{type:String,default:""}},setup(e){const t=E("usedLanguageText");return()=>{var l,n;return s("div",{class:`${c}-footer-item`},[s("label",{class:`${c}-footer-label`},[`${(l=t.value.footer)==null?void 0:l.markdownTotal}:`]),s("span",null,[((n=e.modelValue)==null?void 0:n.length)||0])])}}}),na={checked:{type:Boolean,default:!1},onChange:{type:Function,default:()=>{}}},aa=O({props:na,setup(e){return()=>s("div",{class:[`${c}-checkbox`,e.checked&&`${c}-checkbox-checked`],onClick:()=>{e.onChange(!e.checked)}},null)}}),ia={scrollAuto:{type:Boolean},onScrollAutoChange:{type:Function,default:()=>{}}},ra=O({props:ia,setup(e){const t=E("usedLanguageText");return()=>{var l;return s("div",{class:`${c}-footer-item`},[s("label",{class:`${c}-footer-label`,onClick:()=>{e.onScrollAutoChange(!e.scrollAuto)}},[(l=t.value.footer)==null?void 0:l.scrollAuto]),s(aa,{checked:e.scrollAuto,onChange:e.onScrollAutoChange},null)])}}}),sa={modelValue:{type:String,default:""},footers:{type:Array,default:[]},scrollAuto:{type:Boolean},onScrollAutoChange:{type:Function,default:()=>{}},defFooters:{type:Object}},ca=O({name:"MDEditorFooter",props:sa,setup(e){const t=G(()=>{const n=e.footers.indexOf("="),i=n===-1?e.footers:e.footers.slice(0,n),a=n===-1?[]:e.footers.slice(n,Number.MAX_SAFE_INTEGER);return[i,a]}),l=n=>{if(hl.includes(n))switch(n){case"markdownTotal":return s(oa,{modelValue:e.modelValue},null);case"scrollSwitch":return s(ra,{scrollAuto:e.scrollAuto,onScrollAutoChange:e.onScrollAutoChange},null)}else return e.defFooters instanceof Array?e.defFooters[n]||"":e.defFooters&&e.defFooters.children instanceof Array&&e.defFooters.children[n]||""};return()=>{const n=t.value[0].map(a=>l(a)),i=t.value[1].map(a=>l(a));return s("div",{class:`${c}-footer`},[s("div",{class:`${c}-footer-left`},[n]),s("div",{class:`${c}-footer-right`},[i])])}}}),Be=O({name:"MdEditorV3",props:en,emits:tn,setup(e,t){const{editorId:l,noKatex:n,noMermaid:i,noPrettier:a,noUploadImg:u,noHighlight:v}=e,d=U({scrollAuto:e.scrollAuto}),r=R();qo(e,t),Go(e),Ko(e),Zo(e,t);const[o,m]=Xo(e,t),C=Yo(e);return pe(()=>{k.clear(l)}),Jo(e,t,C,o,m,r),()=>{var $;const g=X({props:e,ctx:t},"defToolbars"),b=X({props:e,ctx:t},"defFooters");return s("div",{id:l,class:[c,e.class,e.theme==="dark"&&`${c}-dark`,o.fullscreen||o.pageFullscreen?`${c}-fullscreen`:""],style:e.style},[s(Tn,{noPrettier:a,toolbars:e.toolbars,toolbarsExclude:e.toolbarsExclude,setting:o,updateSetting:m,tableShape:e.tableShape,defToolbars:g,noUploadImg:u,showToolbarName:e.showToolbarName},null),s(la,{ref:r,modelValue:e.modelValue,setting:o,mdHeadingId:e.mdHeadingId,noMermaid:i,noPrettier:a,sanitize:e.sanitize,placeholder:e.placeholder,noKatex:n,scrollAuto:d.scrollAuto,formatCopiedText:e.formatCopiedText,autofocus:e.autoFocus,disabled:e.disabled,readonly:e.readOnly,maxlength:e.maxLength,autoDetectCode:e.autoDetectCode,noHighlight:v,updateModelValue:f=>{t.emit("update:modelValue",f)},onChange:f=>{e.onChange&&e.onChange(f),t.emit("onChange",f)},onHtmlChanged:f=>{e.onHtmlChanged&&e.onHtmlChanged(f),t.emit("onHtmlChanged",f)},onGetCatalog:f=>{e.onGetCatalog&&e.onGetCatalog(f),t.emit("onGetCatalog",f)},onBlur:f=>{e.onBlur&&e.onBlur(f),t.emit("onBlur",f)},onFocus:f=>{e.onFocus&&e.onFocus(f),t.emit("onFocus",f)},onInput:f=>{e.onInput&&e.onInput(f),t.emit("onInput",f)},completions:e.completions,catalogVisible:C.value,theme:e.theme,noImgZoomIn:e.noImgZoomIn,onDrop:f=>{e.onDrop&&e.onDrop(f),t.emit("onDrop",f)},inputBoxWitdh:e.inputBoxWitdh,onInputBoxWitdhChange:f=>{e.onInputBoxWitdhChange&&e.onInputBoxWitdhChange(f),t.emit("onInputBoxWitdhChange",f)},sanitizeMermaid:e.sanitizeMermaid,transformImgUrl:e.transformImgUrl},null),(($=e.footers)==null?void 0:$.length)>0&&s(ca,{modelValue:e.modelValue,footers:e.footers,defFooters:b,scrollAuto:d.scrollAuto,onScrollAutoChange:f=>d.scrollAuto=f},null)])}}});Be.install=e=>(e.component(Be.name,Be),e.use(Te).use(Ce).use(_e).use(be).use(we),e);export{Be as E};
